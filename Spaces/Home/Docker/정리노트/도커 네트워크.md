## 도커 네트워크란?
도커 네트워크는 **컨테이너 간 통신을 관리하는 기능**이다. 도커는 기본적으로 각 컨테이너를 독립적인 환경에서 실행하지만, 여러 개의 컨테이너가 서로 데이터를 주고받아야 할 때도 있다. 이때 도커 네트워크를 사용하면 컨테이너 간 안전하고 효율적인 통신이 가능하다.

**즉, 같은 호스트 내에서 실행중인 컨테이너 간 연결할 수 있도록 돕는 논리적 네트워크 개념이다.**

### 도커 네트워크의 역할
- **컨테이너 간 통신 제공**: 같은 네트워크에 속한 컨테이너끼리는 IP 주소나 컨테이너 이름으로 연결 가능하다.
- **격리된 환경 유지**: 네트워크를 분리하여 컨테이너 간 불필요한 접근을 차단할 수 있다.
- **네트워크 설정 자동화**: 컨테이너 실행 시 자동으로 IP 주소를 할당하고, DNS 기능을 제공한다.
- **외부 네트워크 연결 지원**: 컨테이너에서 인터넷이나 외부 서비스와 통신할 수 있도록 한다.

## 도커 네트워크 종류
도커는 여러 가지 네트워크 드라이버를 제공하며, 각각의 역할이 다르다.

| 네트워크 드라이버 | 설명                            |
| --------- | ----------------------------- |
| `bridge`  | 기본적으로 사용되는 네트워크, 컨테이너 간 통신 가능 |
| `host`    | 컨테이너가 호스트 네트워크를 공유            |
| `none`    | 네트워크 기능을 비활성화                 |
| `overlay` | 여러 도커 호스트 간 네트워크 연결 (스웜 모드)   |
| `macvlan` | 컨테이너가 물리적 네트워크 인터페이스를 직접 사용   |
이 중에서 `bridge`, `host`, `none` 네트워크는 도커를 설치하면 자동으로 생성되며, 가장 많이 사용된다.


## 브리지(Bridge) 네트워크
브리지 네트워크는 기본적으로 컨테이너 간의 격리된 네트워크 환경을 제공한다. 여러 개의 컨테이너를 같은 브리지 네트워크에 연결하면 서로 통신할 수 있다.

### 특징
- 컨테이너 간 내부 네트워크에서 이름으로 접근 가능
- 기본적으로 `docker0`라는 가상 네트워크 인터페이스를 사용
- 외부 네트워크와 통신하려면 포트 매핑 필요 (`-p 옵션 사용`)

### 사용 예제
컨테이너를 브리지 네트워크에 연결하여 실행하는 방법이다.

```bash
# 새로운 브리지 네트워크 생성
docker network create my_bridge

# 브리지 네트워크에 연결된 컨테이너 실행
docker run -dit --name container1 --network my_bridge alpine sh
docker run -dit --name container2 --network my_bridge alpine sh

# container1에서 container2로 ping 테스트
docker exec -it container1 ping container2
```
이처럼 같은 브리지 네트워크에 있는 컨테이너는 이름으로 서로 접근할 수 있다.


## 호스트(Host) 네트워크
호스트 네트워크는 컨테이너가 별도의 네트워크 인터페이스를 사용하지 않고, 호스트 머신의 네트워크를 그대로 공유하는 방식이다.

### 특징
- 컨테이너가 별도의 네트워크 인터페이스를 갖지 않음
- 컨테이너 내부에서 실행한 서비스가 호스트의 IP와 포트를 그대로 사용
- 성능이 뛰어나지만, 보안적으로 취약할 수 있음

### 사용 예제
호스트 네트워크를 사용하는 컨테이너를 실행하는 방법이다.

```bash
docker run -dit --name my_host_container --network host alpine sh
````
이 경우 컨테이너 내부에서 실행되는 서비스는 `localhost`가 아니라 호스트의 네트워크 주소를 그대로 사용한다.

예를 들어, `nginx`를 호스트 네트워크에서 실행하면 다음과 같다.
```bash
docker run -d --name my_nginx --network host nginx
```
이렇게 실행하면 호스트 머신의 `80` 포트에서 직접 nginx를 접근할 수 있다.


### 단점
#### 1.포트 충돌 가능성
- 컨테이너가 호스트와 같은 네트워크를 사용하기 때문에 동일한 포트를 사용하려고 하면 충돌이 발생할 수 있다.
- 여러 개의 컨테이너를 실행할 때 포트 관리가 어려워질 수 있다.

#### 2. 보안 취약점
- 컨테이너가 호스트와 같은 네트워크 인터페이스를 사용하기 때문에 내부적으로 격리되지 않는다.
- 공격자가 컨테이너를 침해하면 호스트의 네트워크 설정까지 영향을 줄 가능성이 있다.
- 공격자가 컨테이너 내부로 들어와 사용자의 네트워크와 통신을 확인하고 악용할 수 있다.

####  3. 로드 밸런싱 어려움
- `bridge` 네트워크에서는 컨테이너 간 통신이 가능하지만, `host` 네트워크를 사용하면 컨테이너 간 통신을 직접 관리해야 한다.
- 여러 개의 인스턴스를 실행할 때 부하 분산이 어렵다.


## 넌(None) 네트워크
넌 네트워크는 컨테이너가 어떤 네트워크에도 연결되지 않는 상태로 실행된다. 보안이 중요한 환경에서 네트워크 연결을 차단할 때 사용할 수 있다.

### 특징
- 네트워크 인터페이스가 없는 상태
- 외부 및 다른 컨테이너와 통신 불가능
- 내부적으로 네트워크 설정을 직접 하고 싶을 때 유용

### 사용 예제
```bash
docker run -dit --name no_network_container --network none alpine sh
```
이렇게 실행하면 `ping` 등의 네트워크 명령이 작동하지 않는다.


## 오버레이(Overlay) 네트워크
오버레이 네트워크는 여러 개의 도커 호스트를 연결하는 데 사용되며, 도커 스웜 모드에서 주로 사용된다.

### 특징
- 여러 도커 호스트 간의 통신을 지원
- 도커 스웜 클러스터에서 사용 가능
- 컨테이너 간 암호화된 통신 제공

### 사용 예제
```bash
docker network create -d overlay my_overlay
```
이 네트워크는 도커 스웜 모드에서만 제대로 동작한다.


## 맥브이랜(Macvlan) 네트워크
맥브이랜 네트워크는 컨테이너가 물리적 네트워크 인터페이스를 직접 사용하는 방식이다. 특정 컨테이너에 고유한 MAC 주소를 부여할 수 있다.

### 특징
- 컨테이너가 실제 네트워크 카드처럼 동작
- 물리적 네트워크와 직접 통신 가능
- 일반적으로 특정 네트워크 설정이 필요한 경우 사용

### 사용 예제
```bash
docker network create -d macvlan \
  --subnet=192.168.1.0/24 \
  --gateway=192.168.1.1 \
  -o parent=eth0 my_macvlan
```
이 네트워크를 사용하면 컨테이너가 호스트의 네트워크 인터페이스를 직접 사용하게 된다.


## 어떤 네트워크를 선택해야 할까?
어떤 네트워크를 선택할지 고민된다면 아래 기준을 참고하면 된다.

|네트워크 종류|사용 시점|
|---|---|
|`bridge`|기본적으로 컨테이너 간 통신이 필요할 때|
|`host`|성능이 중요한 서비스(예: 로드 밸런서, 프록시)를 실행할 때|
|`none`|네트워크가 필요 없는 컨테이너를 실행할 때|
|`overlay`|여러 개의 도커 호스트에서 컨테이너를 연결할 때|
|`macvlan`|컨테이너가 실제 네트워크에 직접 연결되어야 할 때|
일반적으로 브리지 네트워크가 가장 많이 사용되며, 필요에 따라 다른 네트워크를 선택하면 된다.