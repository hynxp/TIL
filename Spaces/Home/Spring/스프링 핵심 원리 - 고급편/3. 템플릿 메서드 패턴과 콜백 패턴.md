## ë˜ ë¬¸ì œ ë°œìƒ
ë™ì‹œì„± ë¬¸ì œë„ í•´ê²°í–ˆê³ , ë¡œê·¸ ì¶”ì ê¸°ë¥¼ ì˜ ë§Œë“¤ì—ˆë‹¤.

í•˜ì§€ë§Œ ì•„ì§ 'ë¶ˆ-í¸'í•œ ë¶€ë¶„ì´ ìˆë‹¤.
```java
public class OrderControllerV3 {  
   
    @GetMapping("v3/request")  
    public String request(String itemId) {  
        TraceStatus status = null;  
        try {  
            status = trace.begin("OrderController.request()");  
            orderService.orderItem(itemId);  
            trace.end(status);  
            return "ok";  
  
        } catch (Exception e) {  
            trace.exception(status, e);  
            throw e;
        }  
    }  
}

public class OrderServiceV3 {  
  
    public void orderItem(String itemId) {  
        TraceStatus status = null;  
        try {  
            status = trace.begin("OrderService.orderItem()");  
            orderRepository.save(itemId);  
            trace.end(status);  
        } catch (Exception e) {  
            trace.exception(status, e);  
            throw e; // ì˜ˆì™¸ë¥¼ ê¼­ ë‹¤ì‹œ ë˜ì ¸ì¤˜ì•¼ í•¨  
        }  
    }  
}

public class OrderRepositoryV3 {  
  
  
    public void save(String itemId) {  
        TraceStatus status = null;  
        try {  
            status = trace.begin("OrderRepository.save()");  
            // ì €ì¥ ë¡œì§  
            if (itemId.equals("ex")) {  
                throw new IllegalStateException("ì˜ˆì™¸ ë°œìƒ!");  
            }  
            sleep(100);  
            trace.end(status);  
        } catch (Exception e) {  
            trace.exception(status, e);  
            throw e; // ì˜ˆì™¸ë¥¼ ê¼­ ë‹¤ì‹œ ë˜ì ¸ì¤˜ì•¼ í•¨  
        }  
    }  
}
```

ë°”ë¡œ ë°”ë¡œ ì¤‘ë³µ ì½”ë“œê°€ ë„ˆë¬´ ë§ë‹¤ëŠ” ê²ƒì´ë‹¤.
```java
TraceStatus status = null;  
try {  
	status = trace.begin("OrderRepository.save()");  
	// í•µì‹¬ ë¡œì§
	trace.end(status);  
} catch (Exception e) {  
	trace.exception(status, e);  
	throw e; // ì˜ˆì™¸ë¥¼ ê¼­ ë‹¤ì‹œ ë˜ì ¸ì¤˜ì•¼ í•¨  
}  
```
ë³´ë©´ ë™ì¼í•œ íŒ¨í„´ì˜ í…œí”Œë¦¿ì´ ë”± ì •í•´ì ¸ìˆê³  ì¤‘ê°„ì— ë¡œì§ë§Œ ë‹¤ë¥´ë‹¤ëŠ”ê±¸ ì•Œ ìˆ˜ ìˆë‹¤.

ì¤‘ê°„ì˜ ë¡œì§ì„ **í•µì‹¬ ê¸°ëŠ¥**, ê·¸ ë¶€ë¶„ì„ ì œì™¸í•œ ì¤‘ë³µ ì½”ë“œ ë¶€ë¶„ì„ **ë¶€ê°€ ê¸°ëŠ¥**ì´ë¼ê³  í•œë‹¤.

**ì¢‹ì€ ì„¤ê³„ëŠ” ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤.**
ì—¬ê¸°ì„œ í•µì‹¬ ê¸°ëŠ¥ ë¶€ë¶„ì€ ë³€í•˜ê³ , ë¡œê·¸ ì¶”ì ê¸°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì€ ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ë‹¤.
ì´ ë‘˜ì„ ë¶„ë¦¬í•´ì„œ ëª¨ë“ˆí™”í•´ì•¼ í•œë‹¤.


## í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì„ ì ìš©í•´ë³´ì
[[í…œí”Œë¦¿ ë©”ì„œë“œ(Template Method) íŒ¨í„´]]

í…œí”Œë¦¿ ë©”ì„œë“œëŠ” **ì—¬ëŸ¬ í´ë˜ìŠ¤ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œë¥¼ í…œí”Œë¦¿í™”** í•˜ì—¬ ìƒìœ„ í´ë˜ìŠ¤ì—ì„œ ì •ì˜í•˜ê³ , **í•˜ìœ„ í´ë˜ìŠ¤ë§ˆë‹¤ ì„¸ë¶€ ë™ì‘ ì‚¬í•­ì„ ë‹¤ë¥´ê²Œ êµ¬í˜„**í•˜ëŠ” íŒ¨í„´ì´ë‹¤.

ë¶€ëª¨ í´ë˜ìŠ¤ì— ì•Œê³ ë¦¬ì¦˜ì˜ ê³¨ê²©ì¸ í…œí”Œë¦¿ì„ ì •ì˜í•˜ê³ , ì¼ë¶€ ë³€ê²½ë˜ëŠ” ë¡œì§ì€ ìì‹ í´ë˜ìŠ¤ì— ì •ì˜í•˜ëŠ” ê²ƒì´ë‹¤. 
ì´ë ‡ê²Œ í•˜ë©´ ìì‹ í´ë˜ìŠ¤ê°€ ì•Œê³ ë¦¬ì¦˜ì˜ ì „ì²´ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³ , íŠ¹ì • ë¶€ë¶„ë§Œ ì¬ì •ì˜í•  ìˆ˜ ìˆë‹¤. ê²°êµ­ ìƒì†ê³¼ ì˜¤ë²„ë¼ì´ë”©ì„ í†µí•œ ë‹¤í˜•ì„±ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ë‹¤.

ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë ¤ë³´ìë©´ ì´ë ‡ê²Œ í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?
![[ìŠ¤í”„ë§ ê³ ê¸‰_í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´.excalidraw]]

### í…œí”Œë¦¿ ë©”ì„œë“œ ì‘ì„±
```java
public abstract class AbstractTemplate<T> {  
  
    private final LogTrace trace;  
  
    public AbstractTemplate(LogTrace trace) {  
        this.trace = trace;  
    }  
  
    public T execute(String message) {  
        TraceStatus status = null;  
        try {  
            status = trace.begin(message);  
  
            //ë¡œì§ í˜¸ì¶œ  
            T result = call();  
            //ë¡œì§ í˜¸ì¶œ ë  
            trace.end(status);  
            return result;  
        } catch (Exception e) {  
            trace.exception(status, e);  
            throw e;  
        }  
    }  
  
    protected abstract T call();  
  
}
```
ë°˜ë³µë˜ëŠ” ì½”ë“œì˜€ë˜ ë¶€ë¶„ì„ `execute()`ë¡œ ë§Œë“¤ê³ , `call()`ì„ í˜¸ì¶œí•˜ê²Œ í–ˆë‹¤.

ì´ì œ `AbstractTemplate`ì„ ìƒì†ë°›ì•„ `call()`ì„ êµ¬í˜„í•˜ëŠ” ì½”ë“œê°€ í•„ìš”í•˜ë‹¤.

### Controller
```java
public class OrderControllerV4 {  
  
    private final OrderServiceV4 orderService;  
    private final LogTrace trace;  
  
    @GetMapping("v4/request")  
    public String request(String itemId) {  í„´
        AbstractTemplate<String> template = new AbstractTemplate<>(trace) {  
            @Override  
            protected String call() {  
                orderService.orderItem(itemId);  
                return "ok";  
            }  
        };  
        return template.execute("OrderController.request()");  
    }  
}
```
ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ Controllerì˜ í•µì‹¬ ë¡œì§ì„ call()ì— ì ì–´ì£¼ì—ˆë‹¤.

ê·¸ë¦¬ê³  `template.execute("OrderController.request()");`ë¡œ ë¶€ê°€ ê¸°ëŠ¥ì¸ ë¡œê¹…ì„ ìˆ˜í–‰í•œë‹¤.

### Service&Repository
```java
public class OrderServiceV4 {  
    public void orderItem(String itemId) {  
        AbstractTemplate<Void> template = new AbstractTemplate<>(trace) {  
            @Override  
            protected Void call() {  
                orderRepository.save(itemId);  
                return null;  
            }  
        };  
        template.execute("OrderService.orderItem()");  
    }  
}

public class OrderRepositoryV4 {  
  
    public void save(String itemId) {  
        AbstractTemplate<Void> template = new AbstractTemplate<>(trace) {  
            @Override  
            protected Void call() {  
                if (itemId.equals("ex")) {  
                    throw new IllegalStateException("ì˜ˆì™¸ ë°œìƒ!");  
                }  
                sleep(100);  
                return null;  
            }  
        };  
        template.execute("OrderRepository.save()");  
    }  
}
```
Serviceì™€ Repository ë ˆì´ì–´ì—ì„œë„ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ ë³¸ì¸ì˜ í•µì‹¬ ë¡œì§ì„ í˜¸ì¶œí•œë‹¤.


### ì¢‹ì€ ì„¤ê³„ë€?
ì¢‹ì€ ì„¤ê³„ë¼ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œ? ìˆ˜ ë§ì€ ë©‹ì§„ ì •ì˜ê°€ ìˆê² ì§€ë§Œ, ì§„ì •í•œ ì¢‹ì€ ì„¤ê³„ëŠ” ë°”ë¡œ ****ë³€ê²½****ì´ ì¼ì–´ë‚  ë•Œ ìì—°ìŠ¤ëŸ½ê²Œ ë“œëŸ¬ë‚œë‹¤.

ì§€ê¸ˆê¹Œì§€ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ë¶€ë¶„ì„ ëª¨ì•„ì„œ í•˜ë‚˜ë¡œ ëª¨ë“ˆí™”í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶€ë¶„ì„ ë¶„ë¦¬í–ˆë‹¤. ì—¬ê¸°ì„œ ë§Œì•½ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ë¡œì§ì„ ë³€ê²½í•´ì•¼ í•œë‹¤ê³  ìƒê°í•´ë³´ì. ê·¸ë˜ì„œ `AbstractTemplate` ì½”ë“œë¥¼ ë³€ê²½í•´ì•¼ í•œë‹¤ ê°€ì •í•´ë³´ì. ë‹¨ìˆœíˆ

`AbstractTemplate` ì½”ë“œë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤.
í…œí”Œë¦¿ì´ ì—†ëŠ” `V3` ìƒíƒœì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ë¡œì§ì„ ë³€ê²½í•´ì•¼ í•œë‹¤ê³  ìƒê°í•´ë³´ì. ì´ ê²½ìš° ëª¨ë“  í´ë˜ìŠ¤ë¥¼ ë‹¤ ì°¾ì•„ì„œ ê³ ì³ì•¼ í•œë‹¤. í´ë˜ìŠ¤ê°€ ìˆ˜ë°± ê°œë¼ë©´ ìƒê°ë§Œí•´ë„ ë”ì°í•˜ë‹¤.

#### ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP)
`V4` ëŠ” ë‹¨ìˆœíˆ í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì„ ì ìš©í•´ì„œ ì†ŒìŠ¤ì½”ë“œ ëª‡ì¤„ì„ ì¤„ì¸ ê²ƒì´ ì „ë¶€ê°€ ì•„ë‹ˆë‹¤.
ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ë¶€ë¶„ì— ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP)ì„ ì§€í‚¨ ê²ƒì´ë‹¤. ë³€ê²½ ì§€ì ì„ í•˜ë‚˜ë¡œ ëª¨ì•„ì„œ ë³€ê²½ì— ì‰½ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ë§Œë“  ê²ƒì´ë‹¤.


### í•˜ì§€ë§Œ ìƒì†ì˜ ë‹¨ì ì´ ìˆë‹¤.
í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì€ ìƒì†ì„ ì‚¬ìš©í•œë‹¤. ë”°ë¼ì„œ ìƒì†ì—ì„œ ì˜¤ëŠ” ë‹¨ì ë“¤ì„ ê·¸ëŒ€ë¡œ ì•ˆê³ ê°„ë‹¤. íŠ¹íˆ ìì‹ í´ë˜ìŠ¤ê°€ ë¶€ëª¨ í´ë˜ìŠ¤ì™€ ì»´íŒŒì¼ ì‹œì ì— ê°•í•˜ê²Œ ê²°í•©ë˜ëŠ” ë¬¸ì œê°€ ìˆë‹¤. ì´ê²ƒì€ ì˜ì¡´ê´€ê³„ì— ëŒ€í•œ ë¬¸ì œì´ë‹¤. 

ìì‹ í´ë˜ìŠ¤ ì…ì¥ì—ì„œëŠ” ë¶€ëª¨í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì„ ìœ„í•´ ìì‹ í´ë˜ìŠ¤ëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ê³  ìˆë‹¤.

ìƒì†ì„ ë°›ëŠ”ë‹¤ëŠ” ê²ƒì€ íŠ¹ì • ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ì˜ì¡´í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. 
ìì‹ í´ë˜ìŠ¤ì˜ `extends` ë‹¤ìŒì— ë°”ë¡œ ë¶€ëª¨ í´ë˜ìŠ¤ê°€ ì½”ë“œìƒì— ì§€ì •ë˜ì–´ ìˆë‹¤. 
ë”°ë¼ì„œ ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë“  ì‚¬ìš©í•˜ì§€ ì•Šë“  ê°„ì— ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ê°•í•˜ê²Œ ì˜ì¡´í•˜ê²Œ ëœë‹¤. 
ì—¬ê¸°ì„œ ê°•í•˜ê²Œ ì˜ì¡´í•œë‹¤ëŠ” ëœ»ì€ ìì‹ í´ë˜ìŠ¤ì˜ ì½”ë“œì— ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ì½”ë“œê°€ ëª…í™•í•˜ê²Œ ì í˜€ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.

ìì‹ í´ë˜ìŠ¤ ì…ì¥ì—ì„œëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë°, ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ì•Œì•„ì•¼í•œë‹¤. 
ì´ê²ƒì€ ì¢‹ì€ ì„¤ê³„ê°€ ì•„ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ° ì˜ëª»ëœ ì˜ì¡´ê´€ê³„ ë•Œë¬¸ì— ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ìˆ˜ì •í•˜ë©´, ìì‹ í´ë˜ìŠ¤ì—ë„ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.ì¶”ê°€ë¡œ í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì€ ìƒì† êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, ë³„ë„ì˜ í´ë˜ìŠ¤ë‚˜ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ë¶€ë¶„ë„ ë³µì¡í•˜ë‹¤.

ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ì´ëŸ° ë¶€ë¶„ë“¤ì„ ë” ê¹”ë”í•˜ê²Œ ê°œì„ í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?


## ì „ëµ íŒ¨í„´
í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ê³¼ ë¹„ìŠ·í•œ ì—­í• ì„ í•˜ë©´ì„œ ìƒì†ì˜ ë‹¨ì ì„ ì œê±°í•  ìˆ˜ ìˆëŠ” ë””ìì¸ íŒ¨í„´ì´ ë°”ë¡œ [[6. ìŠ¤í”„ë§ì´ ì‚¬ë‘í•œ ë””ìì¸ íŒ¨í„´#ì „ëµ íŒ¨í„´ï¼ˆStrategy Pattern )|ì „ëµ íŒ¨í„´(Strategy Pattern)]]ì´ë‹¤.

íƒ¬í”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì€ ë¶€ëª¨ í´ë˜ìŠ¤ì— ë³€í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ì„ ë‘ê³ , ë³€í•˜ëŠ” ë¶€ë¶„ì„ ìì‹ í´ë˜ìŠ¤ì— ë‘ì–´ì„œ ìƒì†ì„ ì‚¬ìš©í•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í–ˆë‹¤.

![[IMG-20250304025424541.png|400]]
ì „ëµ íŒ¨í„´ì€ ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì„ `Context` ë¼ëŠ” ê³³ì— ë‘ê³ , ë³€í•˜ëŠ” ë¶€ë¶„ì„ `Strategy` ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³  í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ í•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤. ìƒì†ì´ ì•„ë‹ˆë¼ ìœ„ì„ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ë‹¤.

ì „ëµ íŒ¨í„´ì—ì„œ `Context` ëŠ” ë³€í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ ì—­í• ì„ í•˜ê³ , `Strategy` ëŠ” ë³€í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ ì—­í• ì„ í•œë‹¤.

### ì˜ˆì œ
`Strategy` ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³  í•µì‹¬ ê¸°ëŠ¥ì— í•´ë‹¹í•˜ëŠ” ë©”ì„œë“œë¥¼ ì„ ì–¸í•œë‹¤.
```java
 public interface Strategy {  
    void call();  
}
```

ê·¸ë¦¬ê³  í…œí”Œë¦¿ ì—­í• ì„ í•˜ëŠ” `ContextV1`ì„ ìƒì„±í•œ í›„, `execute()`ì— ë¶€ê°€ ê¸°ëŠ¥ì„ ì‘ì„±í•œë‹¤.
í…œí”Œë¦¿ ë©”ì„œë“œì™€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šì§€ë§Œ í•„ë“œë¡œ ë¶€í„° í•µì‹¬ ê¸°ëŠ¥ì„ í˜¸ì¶œí•œë‹¤.
```java
public class ContextV1 {  
  
    private Strategy strategy;  
  
    public ContextV1(Strategy strategy) {  
        this.strategy = strategy;  
    }  
  
    public void execute() {  
        long startTime = System.currentTimeMillis();  
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰  
        strategy.call();  
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¢…ë£Œ  
        long endTime = System.currentTimeMillis();  
        long resultTime = endTime - startTime;  
        log.info("resultTime={}", resultTime);  
    }  
}
```

ê·¸ë¦¬ê³  ì „ëµì˜ êµ¬í˜„ì²´ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•œë‹¤.
```java
public class StrategyLogic1 implements Strategy {  
  
    @Override  
    public void call() {  
        log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰");  
    }  
}

public class StrategyLogic2 implements Strategy {  
  
    @Override  
    public void call() {  
        log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§2 ì‹¤í–‰");  
    }  
}
```

ì´ì œ ì „ëµ íŒ¨í„´ì„ ì‚¬ìš©í•´ë³´ì.
```java
 @Test  
void strategyV1() {  
    StrategyLogic1 strategyLogic1 = new StrategyLogic1();  
    ContextV1 contextV1 = new ContextV1(strategyLogic1);  
    contextV1.execute();  
  
    StrategyLogic2 strategyLogic2 = new StrategyLogic2();  
    ContextV1 contextV2 = new ContextV1(strategyLogic2);  
    contextV2.execute();  
}
```
`Context` ëŠ” ë‚´ë¶€ì— `Strategy strategy` í•„ë“œë¥¼ ê°€ì§€ê³  ìˆìœ¼ë‹ˆ, ë³€í•˜ëŠ” ë¶€ë¶„ì¸ Stragyì˜ êµ¬í˜„ì²´ë¥¼ ì£¼ì…í•˜ë©´ ê° ì „ëµì— ë§ëŠ” ë¡œì§ì´ ì‹¤í–‰ë  ê²ƒì´ë‹¤!
![[Pasted image 20250304030033.png|500]]
ì–´ë””ì„œ ë§ì´ ë³¸ ì½”ë“œ ê°™ì§€ ì•Šì€ê°€? ë°”ë¡œ ìŠ¤í”„ë§ì—ì„œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ ë°”ë¡œ ì „ëµ íŒ¨í„´ì´ë‹¤.

### ìµëª… í´ë˜ìŠ¤, ëŒë‹¤ ì‚¬ìš©
ì „ëµì˜ êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ì§€ ì•Šê³ ë„ ì „ëµ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```java
/**  
 * ìµëª… í´ë˜ìŠ¤ ì‚¬ìš©  
 */  
@Test  
void strategyV2() {  
    Strategy strategyLogic1 = new Strategy() {  
  
        @Override  
        public void call() {  
            log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰");  
        }  
    };  
    ContextV1 contextV1 = new ContextV1(strategyLogic1);  
    log.info("strategyLogic1={}", strategyLogic1);  
    contextV1.execute();  
}  
  
/**  
 * ìµëª… í´ë˜ìŠ¤ ì‚¬ìš© - ëŒë‹¤  
 */  
@Test  
void strategyV4() {  
    ContextV1 contextV1 = new ContextV1(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰"));  
    contextV1.execute();  
  
    ContextV1 contextV2 = new ContextV1(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§2 ì‹¤í–‰"));  
    contextV2.execute();  
}
```


### ì„  ì¡°ë¦½, í›„ ì‹¤í–‰
ìœ„ì˜ ì „ëµ íŒ¨í„´ì€ Contextë¥¼ ìƒì„±í•  ë•Œ Strategyë¥¼ ì£¼ì…í•´ì„œ ì‚¬ìš©í–ˆë‹¤.
ë§Œì•½ì— ì „ëµì„ ë°”ê¿”ì•¼ í•œë‹¤ë©´?

Contextë¥¼ ë˜ ìƒì„±í•´ì•¼ í•œë‹¤.
ì´ ë°©ì‹ì˜ ë‹¨ì ì€ Context ì™€ Strategy ë¥¼ ì¡°ë¦½í•œ ì´í›„ì—ëŠ” ì „ëµì„ ë³€ê²½í•˜ê¸°ê°€ ë²ˆê±°ë¡­ë‹¤ëŠ” ì ì´ë‹¤.
`context.setStrategy(ë³€ê²½ ì „ëµ);`
ì´ë ‡ê²Œ í•˜ë©´ ë˜ì§€ë§Œ, Contextë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ì‚¬ìš©í•  ë•ŒëŠ” ë™ì‹œì„± ì´ìŠˆ ë“± ê³ ë ¤í•  ì ì´ ë§ë‹¤.

ì´ë ‡ê²Œ ì„  ì¡°ë¦½, í›„ ì‹¤í–‰ í•˜ëŠ” ë°©ì‹ë³´ë‹¤ ë” ìœ ì—°í•˜ê²Œ ì „ëµ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ê¹Œ?


### íŒŒë¼ë¯¸í„°ë¡œ ì£¼ì…ë°›ê¸°
ì „ëµì„ íŒŒë¼ë¯¸í„°ë¡œ ì£¼ì…ë°›ìœ¼ë©´ ë˜ì§€ ì•Šì„ê¹Œ?
```java
public class ContextV2 {  
  
    public void execute(Strategy strategy) {  
        long startTime = System.currentTimeMillis();  
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰  
        strategy.call();  
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¢…ë£Œ  
        long endTime = System.currentTimeMillis();  
        long resultTime = endTime - startTime;  
        log.info("resultTime={}", resultTime);  
    }  
}
```

ê·¸ëŸ¼ ì´ë ‡ê²Œ Contextë¥¼ ë‹¤ì‹œ ìƒì„±í•˜ì§€ ì•Šê³  ì „ëµì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
```java
// êµ¬í˜„ì²´ ì‚¬ìš©
@Test  
void strategyV1() {  
    ContextV2 contextV2 = new ContextV2();  
    contextV2.execute(new StrategyLogic1());  
    contextV2.execute(new StrategyLogic2());  
}

// ëŒë‹¤ ì‚¬ìš©
@Test  
void strategyV4() {  
    ContextV1 contextV1 = new ContextV1(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰"));  
    contextV1.execute();  
  
    ContextV1 contextV2 = new ContextV1(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§2 ì‹¤í–‰"));  
    contextV2.execute();  
}
```


## í…œí”Œë¦¿ ì½œë°± íŒ¨í„´
[[6. ìŠ¤í”„ë§ì´ ì‚¬ë‘í•œ ë””ìì¸ íŒ¨í„´#í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ï¼ˆTemplate Callback Pattern - ê²¬ë³¸/íšŒì‹  íŒ¨í„´ï¼‰|í…œí”Œë¦¿ ì½œë°± íŒ¨í„´]]ì€ ì „ëµ íŒ¨í„´ì˜ ë³€í˜•ìœ¼ë¡œ  ì „ëµ íŒ¨í„´ê³¼ ëª¨ë“  ê²ƒì´ ë™ì¼í•œë° ì „ëµì„ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì •ì˜í•´ì„œ ì‚¬ìš©í•œë‹¤ëŠ” íŠ¹ì§• ì´ ìˆë‹¤.

`Context`ëŠ” ë³€í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ ì—­í• ì„ í•œë‹¤. ê·¸ë¦¬ê³  ë³€í•˜ëŠ” ë¶€ë¶„ì€ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ `Strategy` ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì„œ ì²˜ë¦¬í•œë‹¤. ì´ë ‡ê²Œ ë‹¤ë¥¸ ì½”ë“œì˜ ì¸ìˆ˜ë¡œì„œ ë„˜ê²¨ì£¼ëŠ” ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ì½œë°±(callback)ì´ë¼ í•œë‹¤.

> ì½œë°± ì •ì˜
í”„ë¡œê·¸ë˜ë°ì—ì„œ ì½œë°±(callback) ë˜ëŠ” ì½œì• í”„í„° í•¨ìˆ˜(call-after function)ëŠ” ë‹¤ë¥¸ ì½”ë“œì˜ ì¸ìˆ˜ë¡œì„œ ë„˜ê²¨ì£¼ëŠ” ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ë§í•œë‹¤. ì½œë°±ì„ ë„˜ê²¨ë°›ëŠ” ì½”ë“œëŠ” ì´ ì½œë°±ì„ í•„ìš”ì— ë”°ë¼ ì¦‰ì‹œ ì‹¤í–‰í•  ìˆ˜ë„ ìˆê³ , ì•„ë‹ˆë©´ ë‚˜ì¤‘ì— ì‹¤í–‰í•  ìˆ˜ë„ ìˆë‹¤. (ìœ„í‚¤ë°±ê³¼ ì°¸ê³ )

ìŠ¤í”„ë§ì—ì„œëŠ” `JdbcTemplate` , `RestTemplate` , `TransactionTemplate` , `RedisTemplate` ì²˜ëŸ¼ ë‹¤ì–‘í•œ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì´ ì‚¬ìš©ëœë‹¤. ìŠ¤í”„ë§ì—ì„œ ì´ë¦„ì— `XxxTemplate` ê°€ ìˆë‹¤ë©´ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ìˆë‹¤ ìƒê°í•˜ë©´ ëœë‹¤.

### ì˜ˆì œ
í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ êµ¬í˜„í•´ë³´ì. `ContextV2` ì™€ ë‚´ìš©ì´ ê°™ê³  ì´ë¦„ë§Œ ë‹¤ë¥´ë¯€ë¡œ í¬ê²Œ ì–´ë ¤ì›€ì€ ì—†ì„ ê²ƒì´ë‹¤.

ë¨¼ì € ì½œë°± ë¡œì§ì„ ì „ë‹¬í•  ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
```java
public interface Callback {  
    void call();  
}
```

ê·¸ë¦¬ê³  `ContextV2`ì˜ `execute()` ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ í…œí”Œë¦¿ í´ë˜ìŠ¤ë¡œ ë§Œë“ ë‹¤.
ë‹¤ë¥¸ ì ì€ ìœ„ì—ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì£¼ì…ë°›ì•„ ì‹¤í–‰í•œë‹¤.
```java
public class TimeLogTemplate {  

    public void execute(Callback callback) {  
        long startTime = System.currentTimeMillis();  
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰  
        callback.call();  
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¢…ë£Œ  
        long endTime = System.currentTimeMillis();  
        long resultTime = endTime - startTime;  
        log.info("resultTime={}", resultTime);  
    }  
}
```

ì´ì œ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©í•´ ë³´ì.
```java
/**  
 * í…œí”Œë¦¿ ì½œë°± íŒ¨í„´  
 */  
@Test  
void CallbackV1() {  
    TimeLogTemplate template = new TimeLogTemplate();  
    template.execute(new Callback() {  
        @Override  
        public void call() {  
            log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰");  
        }  
    });  
  
    template.execute(new Callback() {  
        @Override  
        public void call() {  
            log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§2 ì‹¤í–‰");  
        }  
    });  
}  
  
/**  
 * í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ - ëŒë‹¤  
 */  
@Test  
void CallbackV2() {  
    TimeLogTemplate template = new TimeLogTemplate();  
    template.execute(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§1 ì‹¤í–‰"));  
    template.execute(() -> log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§2 ì‹¤í–‰"));  
}
```
ë³„ë„ì˜ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•´ë„ ë˜ì§€ë§Œ, ì½œë°±ì„ ì‚¬ìš©í•  ê²½ìš° ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë‚˜ ëŒë‹¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•˜ë‹¤.

ë¬¼ë¡  ì—¬ëŸ¬ê³³ì—ì„œ í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ê²½ìš° ì¬ì‚¬ìš©ì„ ìœ„í•´ ì½œë°±ì„ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ë„ ëœë‹¤.


### ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ìš©
![[ìŠ¤í”„ë§ ê³ ê¸‰_í…œí”Œë¦¿ ì½œë°± íŒ¨í„´.excalidraw]]
ì´ì œ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ìš©í•´ë³´ì.

ì½œë°±ì„ ì „ë‹¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
```java
public interface TraceCallback<T> {  
  
    T call();  
}
```

ê·¸ë¦¬ê³  í…œí”Œë¦¿ ì—­í• ì„ í•  í´ë˜ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
```java
public class TraceTemplate {  
  
    private final LogTrace trace;  
  
    public TraceTemplate(LogTrace trace) {  
        this.trace = trace;  
    }  
  
    public <T> T execute(String message, TraceCallback<T> callback) {  
        TraceStatus status = null;  
        try {  
            status = trace.begin(message);  
  
            //ë¡œì§ í˜¸ì¶œ  
            T result = callback.call();  
            //ë¡œì§ í˜¸ì¶œ ë  
            trace.end(status);  
            return result;  
        } catch (Exception e) {  
            trace.exception(status, e);  
            throw e;  
        }  
    }  
}
```
`execute(..)` ë¥¼ ë³´ë©´ `message` ë°ì´í„°ì™€ ì½œë°±ì¸ `TraceCallback callback` ì„ ì „ë‹¬ ë°›ëŠ”ë‹¤.

ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤, ë ˆí¬ì§€í† ë¦¬ ë ˆì´ì–´ì— í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©í•´ ë³´ì.

```java
@RestController  
public class OrderControllerV5 {  
  
    private final OrderServiceV5 orderService;  
    private final TraceTemplate template;  
  
    public OrderControllerV5(OrderServiceV5 orderService, LogTrace trace) {  
        this.orderService = orderService;  
        this.template = new TraceTemplate(trace);  
    }  
  
    @GetMapping("v5/request")  
    public String request(String itemId) {  
        return template.execute("OrderController.request()", new TraceCallback<>() {  
            @Override  
            public String call() {  
                orderService.orderItem(itemId);  
                return "ok";  
            }  
        });  
    }  
}
```

#### `this.template = new TraceTemplate(trace)` 
ìƒì„±ìì—ì„œ traceë¡œ í…œí”Œë¦¿ì„ ìƒì„±í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— `@RequiredArgsConstructor`ì„ ì œê±°í–ˆë‹¤.
ë¬¼ë¡  Â `TraceTemplate` ë¥¼ ì²˜ìŒë¶€í„° ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ì£¼ì…ë°›ì•„ë„ ëœë‹¤.

#### `template.execute(.., new TraceCallback(){..})``
ê·¸ë¦¬ê³  ë§Œë“  í…œí”Œë¦¿ì„ ì‹¤í–‰í•˜ë©´ì„œ ì½œë°±ì„ ì „ë‹¬í•œë‹¤.
ì—¬ê¸°ì„œëŠ” ìµëª… í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í–ˆë‹¤.

```java
public class OrderServiceV5 {  
  
    private final OrderRepositoryV5 orderRepository;  
    private final TraceTemplate template;  
  
    public OrderServiceV5(OrderRepositoryV5 orderRepository, LogTrace trace) {  
        this.orderRepository = orderRepository;  
        this.template = new TraceTemplate(trace);  
    }  
  
    public void orderItem(String itemId) {  
        template.execute("OrderService.orderItem()", () -> {  
            orderRepository.save(itemId);  
            return null;  
        });  
    }  
}
```
Service ë ˆì´ì–´ì—ì„œëŠ” ëŒë‹¤ë¡œ ì½œë°±ì„ ì „ë‹¬í•˜ì—¬ ë¶€ê°€ ê¸°ëŠ¥(ë¡œê¹…)ê³¼ í•µì‹¬ ë¡œì§ì„ ì‹¤í–‰í•œë‹¤.


## ì •ë¦¬
ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” ë³€í•˜ëŠ” ì½”ë“œì™€ ë³€í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ê³ , ë” ì ì€ ì½”ë“œë¡œ ë¡œê·¸ ì¶”ì ê¸°ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ ê³ êµ°ë¶„íˆ¬í–ˆë‹¤.

í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´, ì „ëµ íŒ¨í„´, ê·¸ë¦¬ê³  í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ê¹Œì§€ ì§„í–‰í•˜ë©´ì„œ ë³€í•˜ëŠ” ì½”ë“œì™€ ë³€í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ë¶„ë¦¬í–ˆë‹¤.

ê·¸ë¦¬ê³  ìµœì¢…ì ìœ¼ë¡œ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì ìš©í•˜ê³  ì½œë°±ìœ¼ë¡œ ëŒë‹¤ë¥¼ ì‚¬ìš©í•´ì„œ ì½”ë“œ ì‚¬ìš©ë„ ìµœì†Œí™” í•  ìˆ˜ ìˆì—ˆë‹¤.

### í•œê³„
ê·¸ëŸ°ë° ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ë°©ì‹ì˜ í•œê³„ëŠ” ì•„ë¬´ë¦¬ ìµœì í™”ë¥¼ í•´ë„ ê²°êµ­ ë¡œê·¸ ì¶”ì ê¸°ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ì„œ ì›ë³¸ ì½”ë“œ(`Controller, Service, Repository`)ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤. 
í´ë˜ìŠ¤ê°€ ìˆ˜ë°±ê°œì´ë©´ ìˆ˜ë°±ê°œë¥¼ ë” í˜ë“¤ê²Œ ìˆ˜ì •í•˜ëŠ”ê°€ ì¡°ê¸ˆ ëœ í˜ë“¤ê²Œ ìˆ˜ì •í•˜ëŠ”ê°€ì˜ ì°¨ì´ê°€ ìˆì„ ë¿, ë³¸ì§ˆì ìœ¼ë¡œ ì½”ë“œë¥¼ ë‹¤ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ê²ƒì€ ë§ˆì°¬ê°€ì§€ì´ë‹¤.

ê°œë°œìì˜ ê²Œìœ¼ë¦„ì— ëŒ€í•œ ìš•ì‹¬ì€ ëì´ ì—†ë‹¤. ìˆ˜ ë§ì€ ê°œë°œìê°€ ì´ ë¬¸ì œì— ëŒ€í•´ì„œ ì§‘ìš”í•˜ê²Œ ê³ ë¯¼í•´ì™”ê³ , ì—¬ëŸ¬ê°€ì§€ ë°©í–¥ìœ¼ë¡œ í•´ê²°ì±…ì„ ë§Œë“¤ì–´ì™”ë‹¤. ì§€ê¸ˆë¶€í„° ì›ë³¸ ì½”ë“œë¥¼ ì†ëŒ€ì§€ ì•Šê³  ë¡œê·¸ ì¶”ì ê¸°ë¥¼ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œ í”„ë¡ì‹œ ê°œë…ì„ ë¨¼ì € ì´í•´í•´ì•¼ í•œë‹¤.

> ğŸ’¡ ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ë°©ì‹ì€ ì‹¤ì œ ìŠ¤í”„ë§ ì•ˆì—ì„œ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ì´ë‹¤. `XxxTemplate` ë¥¼ ë§Œë‚˜ë©´ ì´ë²ˆì— í•™ìŠµí•œ ë‚´ìš©ì„ ë– ì˜¬ë ¤ë³´ë©´ ì–´ë–»ê²Œ ëŒì•„ê°€ëŠ”ì§€ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.