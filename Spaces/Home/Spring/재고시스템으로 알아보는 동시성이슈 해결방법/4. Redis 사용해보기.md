레디스를 활용하여 동시성 문제를 해결할 때 사용하는 대표적인 라이브러리 2가지가 있다.

## 세팅
`docker pull redis`
`docker run --name myredis -d -p 6379:6379 redis`

## Lettuce
구현이 간단하다.
`setnx()` 명령어를 활용하여 분산락을 구현한다.
`set if not exist`의 줄임말로 key와 value를 set할 때 기존의 값이 없을 때만 set하는 명령어이다.

spin lock 방식이므로 retry방식을 개발자가 직접 작성해야한다.
락을 획득하려는 스레드가 락을 획득할 수 있는지 반복적으로 확인하면서 락 획득을 시도하는 방식이다.

![[Pasted image 20250223032418.png|500]]

## Redisson
`pub-sub` 기반으로 Lock 구현 제공
![[Pasted image 20250223032519.png|500]]
채널을 하나 만들고 락을 점유 중인 스레드가 락을 획득하려고 대기중인 스레드에게 해제를 알려주면 안내를 받은 스레드가 락 획득 시도를 하는 방식이다.

별도의 retry 로직을 작성하지 않아도 된다.

자신이 점유하고 있는 락을 해제할 때 채널에 메시지를 보내줌으로써 락을 획득해야 하는 스레드들에게 락 획득을 하라고 전달해준다.

#### 장점
Lettuce는 계속 시도하는 반면, 레디슨은 락 해제가 되엇을 때 한 번 혹은 몇번만 시도하기 때문에 레디스의 부하를 줄여준다

#### 단점
별도의 라이브러리를 사용해야 하고 복잡하다는 단점이 있다.



## 요약
### Lettuce
- 구현이 간단하다
- spring data redis 를 이용하면 lettuce 가 기본이기때문에 별도의 라이브러리를 사용하지 않아도 된다.
- spin lock 방식이기때문에 동시에 많은 스레드가 lock 획득 대기 상태라면 redis 에 부하가 갈 수 있다.


### Redisson 
- 락 획득 재시도를 기본으로 제공한다.
- pub-sub 방식으로 구현이 되어있기 때문에 lettuce 와 비교했을 때 redis에 부하가 덜 간다.
- 하지만 Spring Data Redis의 기본 라이브러리는 Lettuce기 때문에 별도의 라이브러리를 사용해야한다.
- lock 을 라이브러리 차원에서 제공해주기 떄문에 사용법을 공부해야 한다.


### 실무에서는 ?
- 재시도가 필요하지 않은 lock은 lettuce 활용
- 재시도가 필요한 경우에는 redisson 를 활용


