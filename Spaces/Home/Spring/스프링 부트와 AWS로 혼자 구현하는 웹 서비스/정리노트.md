
### build.gradle
```xml
buildscript {
    ext {
        springBootVersion = '2.1.7.RELEASE'
    }
    repositories {
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
    }
}
```

- ì´ í”„ë¡œì íŠ¸ì˜ í”ŒëŸ¬ê·¸ì¸ ì˜ì¡´ì„± ê´€ë¦¬ë¥¼ ìœ„í•œ ì„¤ì •(ì¸í…”ë¦¬ì œì´ì˜ í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬ê°€ ì•„ë‹˜)
- **ext**
    - build.gradleì—ì„œ ì‚¬ìš©í•˜ëŠ” ì „ì—­ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ê² ë‹¤ëŠ” ì˜ë¯¸

```xml
apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'
```

- ì•ì„œ ì„ ì–¸í•œ í”ŒëŸ¬ê·¸ì¸ ì˜ì¡´ì„±ë“¤ì„ ì ìš©í•  ê²ƒì¸ì§€ ê²°ì •í•˜ëŠ” ì½”ë“œ
- ì• 4ê°œì˜ í”ŒëŸ¬ê·¸ì¸ì€ ìë°”ì™€ ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ í•„ìˆ˜ í”ŒëŸ¬ê·¸ì¸ë“¤ì´ë‹ˆ í•­ìƒ ì¶”ê°€
- `io.spring.dependency-management` í”ŒëŸ¬ê·¸ì¸ì€ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ì˜ì¡´ì„±ë“¤ì„ ê´€ë¦¬í•´ ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì´ë¼ ê¼­ ì¶”ê°€í•´ì•¼ë§Œ í•¨

```xml
repositories {
    mavenCentral()
    jcenter()
}
```

- **repositories**
    - ê°ì¢… ì˜ì¡´ì„±(ë¼ì´ë¸ŒëŸ¬ë¦¬)ë“¤ì„ ì–´ë–¤ ì›ê²© ì €ì¥ì†Œì—ì„œ ë°›ì„ì§€ ì •í•¨
    - jcenter
        - ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—…ë¡œë“œë¥¼ ê°„ë‹¨í•˜ê²Œ í•´ ìµœê·¼ì— ë§ì´ ì‚¬ìš©

```xml
dependencies {
    compile('org.springframework.boot:spring-boot-starter-web')
    compile('org.projectlombok:lombok')
    compile('org.springframework.boot:spring-boot-starter-data-jpa')
    compile('com.h2database:h2')
    compile('org.springframework.boot:spring-boot-starter-mustache')
    compile('org.springframework.boot:spring-boot-starter-oauth2-client')
    compile('org.springframework.session:spring-session-jdbc')
    testCompile('org.springframework.boot:spring-boot-starter-test')
    testCompile("org.springframework.security:spring-security-test")
}
```

- í”„ë¡œì íŠ¸ ê°œë°œì— í•„ìš”í•œ ì˜ì¡´ì„±ë“¤ì„ ì„ ì–¸í•˜ëŠ” ê³³
- íŠ¹ì • ë²„ì „ì„ ëª…ì‹œí•˜ì§€ ì•Šì•„ì•¼ ìœ„ì— extë¡œ ì„ ì–¸í•œ ì „ì—­ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.

### í…ŒìŠ¤íŠ¸ ì½”ë“œ

**ë¨¼ì € ì§šê³  ê°ˆ ê²ƒì€ TDDì™€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ë¥´ë‹¤.**

- TDD
    - í…ŒìŠ¤íŠ¸ê°€ ì£¼ë„í•˜ëŠ” ê°œë°œì„ ì´ì•¼ê¸° í•˜ëŠ” ê²ƒ
    - í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë¨¼ì € ì‘ì„±í•˜ëŠ” ê²ƒë¶€í„° ì‹œì‘
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
    - TDDì˜ ì²« ë²ˆì§¸ ë‹¨ê³„ì¸ ê¸°ëŠ¥ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒ
    - TDDì™€ ë‹¬ë¦¬ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ê¼­ ë¨¼ì € ì‘ì„±í•´ì•¼ í•˜ëŠ”ê²ƒë„ ì•„ë‹ˆê³ , ë¦¬íŒ©í† ë§ë„ í¬í•¨ë˜ì§€ ì•ŠìŒ
    - ìˆœìˆ˜í•˜ê²Œ í…ŒìŠ¤íŠ¸ ì½”ë“œë§Œ ì‘ì„±í•˜ëŠ” ê²ƒ

â“**í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì™œ ì‘ì„±í•˜ëŠ”ê°€**

ë‚˜ë„ í˜„ì¬ api ê´€ë ¨ ê°œë°œí•  ë•Œ

1. ì„œë²„ ì˜¬ë¦¬ê³ 
2. í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œ http ìš”ì²­í•˜ê³ 
3. ê²°ê³¼ë³´ê³ 
4. ê³ ì¹˜ê³ 

1~4ë¥¼ ë°˜ë³µí–ˆë‹¤. ì´ê²Œ ë‹¤ í…ŒìŠ¤íŠ¸ì½”ë“œê°€ ì—†ì–´ì„œ ì§ì ‘ í™•ì¸í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ì¶”ê°€ë¡œ ê¸°ì¡´ì— ì˜ë˜ë˜ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ìˆëŠ”ì§€ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.

ë‚˜ë„ ì‹ ì… ë•Œ íšŒì›ê°€ì… í•„ìˆ˜ ê°’ì— ìƒë…„ì›”ì¼ì„ ëºë”ë‹ˆ ìƒë…„ì›”ì¼ì´ í•„ìˆ˜ê°’ì¸ ê¸°ëŠ¥ë“¤ì—ì„œ ì˜¤ë¥˜ê°€ ì¤„ì¤„ì´ í„°ì¡Œì—ˆë˜ ê¸°ì–µì´â€¦

**í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì„ ë„ì™€ì£¼ëŠ” í”„ë ˆì„ì›Œí¬**

- JUnit - Java
- DBUnit - DB
- CppUnit - C++
- NUnit - .net

```java
@RunWith(SpringRunner.class)
@WebMvcTest(controllers = HelloController.class)
public class HelloControllerTest {

    @Autowired
    private MockMvc mvc;

    @Test
    public void helloê°€_ë¦¬í„´ëœë‹¤() throws Exception {
        String hello = "hello";

        mvc.perform(get("/hello"))
                .andExpect(status().isOk())
                .andExpect(content().string(hello));
    }

    @Test
    public void helloDtoê°€_ë¦¬í„´ëœë‹¤() throws Exception {
        String name = "hello";
        int amount = 1000;

        mvc.perform(
                    get("/hello/dto")
                            .param("name", name)
                            .param("amount", String.valueOf(amount)))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.name", is(name)))
                .andExpect(jsonPath("$.amount", is(amount)));
    }
}
```

- **@RunWith(SpringRunner.class)**
    
    - í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•Œ JUnitì— ë‚´ì¥ëœ ì‹¤í–‰ì ì™¸ì— ë‹¤ë¥¸ ì‹¤í–‰ìë¥¼ ì‹¤í–‰ì‹œí‚´
    - ì—¬ê¸°ì„œëŠ” SpringRunnerë¼ëŠ” ìŠ¤í”„ë§ ì‹¤í–‰ìë¥¼ ì‚¬ìš©
    - ì¦‰, ìŠ¤í”„ë§ ë¶€íŠ¸ í…ŒìŠ¤íŠ¸ì™€ JUnit ì‚¬ì´ì— ì—°ê²°ì ì—­í• 
- **@WebMvcTest**
    
    - ì—¬ëŸ¬ ìŠ¤í”„ë§ í…ŒìŠ¤íŠ¸ ì–´ë…¸í…Œì´ì…˜ ì¤‘, Web(Spring MVC)ì— ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” ì–´ë…¸í…Œì´ì…˜
    - @Controller, @ControllerAdvice ë“±ì„ ì‚¬ìš©
    - @Service, @Repository, @Repository ë“±ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- **MockMvc**
    
    - ì›¹ APIë¥¼ í…ŒìŠ¤íŠ¸í•  ë•Œ ì‚¬ìš©
    - ì´ í´ë˜ìŠ¤ë¥¼ í†µí•´ HTTP GET, POST ë“±ì— ëŒ€í•œ API í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥
        - mvc.perform(get(â€/helloâ€))
- **.andExpect()**
    
    - mvc.performì˜ ê²°ê³¼ë¥¼ ê²€ì¦
    - status().isOk()
        - HTTP Headerì˜ Statusë¥¼ ê²€ì¦
    - content().string(hello)
        - ì‘ë‹µ ë³¸ë¬¸ì˜ ë‚´ìš©ì„ ê²€ì¦
- **jsonPath**
    
    - JSON ì‘ë‹µê°’ì„ í•„ë“œë³„ë¡œ ê²€ì¦í•  ìˆ˜ ìˆëŠ” ë©”ì†Œë“œ
    - $ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•„ë“œëª…ì„ ëª…ì‹œí•œë‹¤.

### í…ŒìŠ¤íŠ¸ ì½”ë“œ ìˆ˜í–‰ ì‹œ application.properties

í…ŒìŠ¤íŠ¸ ì½”ë“œ ìˆ˜í–‰ ì‹œ src/test/resources/application.propertiesíŒŒì¼ì´ ì—†ë‹¤ë©´

mainì˜ application.propertiesì„ ê·¸ëŒ€ë¡œ ê°–ê³  ì˜¨ë‹¤.

ìë™ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ì˜µì…˜ì˜ ë²”ìœ„ëŠ” application.propertiesê¹Œì§€ë‹¤.

application-~~.propertiesëŠ” ê°–ê³ ì˜¤ì§€ ì•ŠëŠ”ë‹¤.

application.propertiesì— ê°€ì§œë¡œ ì„¤ì •ê°’ì„ ë„£ì–´ ì£¼ê±°ë‚˜ test/í•˜ìœ„ì— ë§Œë“¤ì–´ì¤˜ì•¼ í•œë‹¤.

### @SpringBootApplication

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

ì´ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì¸í•´ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ìë™ ì„¤ì •, ìŠ¤í”„ë§ Beanì½ê¸°ì™€ ìƒì„±ì„ ëª¨ë‘ ìë™ìœ¼ë¡œ ì„¤ì •ëœë‹¤.

**@SpringBootApplication**ê°€ ìˆëŠ” ìœ„ì¹˜ë¶€í„° ì„¤ì •ì„ ì½ì–´ê°€ê¸° ë•Œë¬¸ì— ì´ í´ë˜ìŠ¤ëŠ” í•­ìƒ í”„ë¡œì íŠ¸ì˜ ìµœìƒë‹¨ì— ìœ„ì¹˜í•´ì•¼ í•œë‹¤.

`SpringApplication.*run*(Application.class, args);`

ì´ ì½”ë“œë¡œ ì¸í•´ ë‚´ì¥ WASë¥¼ ì‹¤í–‰í•œë‹¤. (ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ë§Œë“¤ì–´ì§„ Jar íŒŒì¼ë¡œ ì‹¤í–‰í•˜ë©´ ë¨)

### @RestController, @GetMapping

```java
@RestController
public class HelloController {

    @GetMapping("/helloO")
    public String hello() {
        return "hello";
    }
}
```

- **@RestController**

ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ JSONìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.

ì˜ˆì „ì— @ResponseBodyë¥¼ ê° ë©”ì†Œë“œë§ˆë‹¤ ì„ ì–¸í–ˆë˜ ê²ƒì„ í•œë²ˆì— ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤ê³  ìƒê°í•˜ë©´ ë¨.

- **@GetMapping**

HTTP Methodì¸ Getì˜ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆëŠ” APIë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤.

ì˜ˆì „ @RequestMapping(method = RequestMethod.GET)ìœ¼ë¡œ ì‚¬ìš©ëì—ˆìŒ

### JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

### **íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜**

**ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤**ëŠ” ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ì €ì¥í• ì§€ì— ì´ˆì ì´ ë§ì¶°ì§„ ê¸°ìˆ ì´ë‹¤.

ë°˜ëŒ€ë¡œ **ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´**ëŠ” ë©”ì‹œì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê¸°ëŠ¥ê³¼ ì†ì„±ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê¸°ìˆ ì´ë‹¤.

ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¡œ ê°ì²´ì§€í–¥ì„ í‘œí˜„í•  ìˆ˜ ìˆì„ê¹Œ?

ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì˜ íŒ¨ëŸ¬ë‹¤ì„ì´ ì„œë¡œ ë‹¤ë¥¸ë°, ê°ì²´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ê±±ì¥í•˜ë ¤ê³  í•˜ë‹ˆ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤.

### ì˜ˆì‹œ

ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì—ì„œ ë¶€ëª¨ê°€ ë˜ëŠ” ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ

```java
User user = findUser();
Group group = user.getGroup();
```

ëˆ„êµ¬ë‚˜ ëª…í™•í•˜ê²Œ Userì™€ Groupì€ ë¶€ëª¨-ìì‹ ê´€ê³„ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¶”ê°€ë˜ë©´?

```java
Usar user = userDao.finduser();
Gorup group = gorupoDao.findGorup(user.getGroupId()
```

User ë”°ë¡œ, Group ë”°ë¡œ ì¡°íšŒí•´ì•¼ í•œë‹¤.

ì´ ë‘˜ì´ ì–´ë–¤ ê´€ê³„ì¸ì§€ ì•Œ ìˆ˜ ìˆì„ê¹Œ?

ìƒì†, 1:Në“± ë‹¤ì–‘í•œ ê°ì²´ ëª¨ë¸ë§ì„ ë°ì´í„°ë² ì´ìŠ¤ë¡œëŠ” êµ¬í˜„í•  ìˆ˜ ì—†ë‹¤.

ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì€ ì ì  **ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë§**ì—ë§Œ ì§‘ì¤‘í•˜ê²Œ ëœë‹¤.

### ì •ë¦¬

ì´ë ‡ê²Œ ì„œë¡œ ì§€í–¥í•˜ëŠ” ë°”ê°€ ë‹¤ë¥¸ ê°ì²´ë¹„í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì™€, ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì¤‘ê°„ì—ì„œ íŒ¨ëŸ¬ë‹¤ì„ ì¼ì¹˜ë¥¼ ì‹œì¼œì£¼ê¸° ìœ„í•œ ê¸°ìˆ ì´ **JPA**ë‹¤.

ì¦‰, ê°œë°œìëŠ” ê°ì²´ì§€í–¥ì ìœ¼ë¡œ í”„ë¡œê·¸ë˜ë°ì„ í•˜ê³ , JPAê°€ ì´ë¥¼ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì— ë§ê²Œ SQLì„ ëŒ€ì‹  ìƒì„±í•´ì„œ ì‹¤í–‰í•œë‹¤.

ê°œë°œìëŠ” í•­ìƒ ê°ì²´ì§€í–¥ì ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë‹ˆ **SQLì— ì¢…ì†ì ì¸ ê°œë°œ**ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

### @WebMvcTest ì™€ @EnableJpaAuditing

@WebMvcTestë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ìˆì—ˆë‹¤.

```java
@RunWith(SpringRunner.class)
@WebMvcTest(controllers = HelloController.class)
public class HelloControllerTest {
	...
}
```

ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëŒë¦¬ë‹ˆ _**IllegalArgumentException: At least one JPA metamodel must be present!**_

ë¼ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

ì±…ì—ëŠ” ë‹¨ìˆœíˆ

> @WebMvcTestëŠ” @EnableJpaAuditingë¡œ ì¸í•´ ë°œìƒí•œë‹¤. @EnableJpaAuditingë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  ìµœì†Œ í•˜ë‚˜ì˜ @Entity í´ë˜ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. @WebMvcTestì´ë‹¤ ë³´ë‹ˆ ë‹¹ì—°íˆ ì—†ìŠµë‹ˆë‹¤.

ë¼ê³  ë¼ìˆì—ˆë‹¤.. ë‚œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì²˜ìŒì´ë¼ â€˜@WebMvcTestì´ë‹¤ ë³´ë‹ˆ ë‹¹ì—°íˆ ì—†ìŠµë‹ˆë‹¤.â€™ë¼ëŠ” ë§ì´ ì´í•´ê°€ ì•ˆê°€ì„œ ì°¾ì•„ë³´ì•˜ë‹¤.

### ì›ì¸

@WebMvcTestëŠ” 3-tier Layeredì—ì„œ Presend Layerë§Œ ìŠ¤ìº”í•œë‹¤.

ì¦‰ @Respository, @Service, @ComponentëŠ” ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•ŠëŠ”ë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/a3830857-921c-46d9-9bd8-ec2841fa8c16/87598e62-23ce-47d7-9653-fe8513979b72/Untitled.png)

í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëŒë¦´ ë•Œ ~~Applicationì´ ëŒë©´ì„œ ì‘ë™í•œë‹¤ê³  í•œë‹¤.

ì´ë•Œ @EnableJpaAuditin ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì¸í•´ JPAì— ê´€ë ¨ëœ ë¹ˆì„ ì°¾ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```java
@EnableJpaAuditing //**
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

### í•´ê²°

Applicationì˜ @EnableJpaAuditingì„ ì œê±°í•˜ê³ , ì´ê²ƒì„ ê´€ë¦¬í•˜ëŠ” ì„¤ì •í´ë˜ìŠ¤ë¥¼ ë”°ë¡œ ë¶„ë¦¬í•œë‹¤.

```java
@SpringBootApplication
public class Application {
    public staticvoid main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

```java
@Configuration
@EnableJpaAuditing // JPA Auditing í™œì„±í™”
public class JpaConfig {
}
```

> JPA ê¸°ëŠ¥ê¹Œì§€ í•œë²ˆì— í…ŒìŠ¤íŠ¸í•  ë•ŒëŠ” @SpringBootTestì™€ TestRestTemplateë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ì°¸ê³ 

[](https://velog.io/@jhp1115/3-tier-Layered-Architecture%EC%99%80-MVC)[https://velog.io/@jhp1115/3-tier-Layered-Architectureì™€-MVC](https://velog.io/@jhp1115/3-tier-Layered-Architecture%EC%99%80-MVC)

[https://gom20.tistory.com/123](https://gom20.tistory.com/123)

[https://1-7171771.tistory.com/136](https://1-7171771.tistory.com/136)

### @Builder - ë¹Œë” íŒ¨í„´

```java
@Builder
public Posts(String title, String content, String author) {
    this.title = title;
    this.content = content;
    this.author = author;
}
```

ì–´ëŠ í•„ë“œì— ì–´ë–¤ ê°’ì„ ì±„ì›Œì•¼í• ì§€ ëª…í™•í•˜ê²Œ ì¸ì§€í•˜ëŠ” ê°ì²´ ìƒì„± ë°©ë²•

[ğŸ’  ë¹Œë”(Builder) íŒ¨í„´ - ì™„ë²½ ë§ˆìŠ¤í„°í•˜ê¸°](https://inpa.tistory.com/entry/GOF-%F0%9F%92%A0-%EB%B9%8C%EB%8D%94Builder-%ED%8C%A8%ED%84%B4-%EB%81%9D%ED%8C%90%EC%99%95-%EC%A0%95%EB%A6%AC)

### ~~Repositoryì™€ JpaRepository

```java
public interface PostsRepository extends JpaRepository<Posts, Long> {

    @Query("SELECT p FROM Posts p ORDER BY p.id DESC")
    List<Posts> findAllDesc();
}
```

ë³´í†µ MyBatis ë“±ì—ì„œ Daoë¼ê³  ë¶ˆë¦¬ëŠ” DB Layer ì ‘ê·¼ì

JPAì—ì„  Repositoryë¼ê³  ë¶€ë¥´ë©° ì¸í„°í˜ì´ìŠ¤ë¡œ ìƒì„±í•œë‹¤.

ë‹¨ìˆœíˆ ì¸í„°í˜ì´ìŠ¤ ìƒì„± í›„ `JpaRepository<Entity í´ë˜ìŠ¤, PK íƒ€ì…>`ë¥¼ ìƒì†í•˜ë©´ ê¸°ë³¸ CRUD ë©”ì†Œë“œê°€ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.

`@Repository`ë¥¼ ì¶”ê°€í•  í•„ìš”ë„ ì—†ë‹¤.

**ì£¼ì˜í•  ì **

Entity í´ë˜ìŠ¤ì™€ ê¸°ë³¸ Entity RepositoryëŠ” í•¨ê»˜ ìœ„ì¹˜í•´ì•¼ í•œë‹¤.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/a3830857-921c-46d9-9bd8-ec2841fa8c16/ef7efcaf-d5f6-4bd8-b566-d013650f7ced/Untitled.png)

**Entity** í´ë˜ìŠ¤ëŠ” ê¸°ë³¸ **Repository** ì—†ì´ëŠ” ì œëŒ€ë¡œ ì—­í• ì„ í•  ìˆ˜ê°€ ì—†ë‹¤.

### Entity í´ë˜ìŠ¤ì™€ Dto

- **Entity**

ì ˆëŒ€ë¡œ Entity í´ë˜ìŠ¤ë¥¼ Request/Response í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•´ì„œëŠ” ì•ˆ ëœë‹¤.

Entity í´ë˜ìŠ¤ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ ë§ë‹¿ì€ í•µì‹¬ í´ë˜ìŠ¤ë‹¤.

Entity í´ë˜ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í…Œì´ë¸”ì´ ìƒì„±ë˜ê³ , ìŠ¤í‚¤ë§ˆê°€ ë³€ê²½ëœë‹¤.

- **Dto**

DtoëŠ” Viewë¥¼ ìœ„í•œ í´ë˜ìŠ¤ë¼ ì •ë§ ìì£¼ ë³€ê²½ì´ í•„ìš”í•˜ë‹¤.

**View Layerì™€ DB Layerì˜ ì—­í•  ë¶„ë¦¬ë¥¼ ì² ì €í•˜ê²Œ í•˜ëŠ” ê²ƒ!**

### ë¨¸ìŠ¤í…Œì¹˜ ë¬¸ë²•

[[Mustache] ê¸°ë³¸ ë¬¸ë²•](https://smpark1020.tistory.com/191)

### ë¸Œë¼ìš°ì €ì˜ ì „ì—­ ë³€ìˆ˜ ì¶©ëŒ ë¬¸ì œë¥¼ íšŒí”¼í•˜ëŠ” ë°©ë²•

```jsx
var main = {
    init : function () {
        var _this = this;
        $('#btn-save').on('click', function () {
            _this.save();
        });

        $('#btn-update').on('click', function () {
            _this.update();
        });

        $('#btn-delete').on('click', function () {
            _this.delete();
        });
    },
    save : function () {
        var data = {
            title: $('#title').val(),
            author: $('#author').val(),
            content: $('#content').val()
        };

        $.ajax({
            type: 'POST',
            url: '/api/v1/posts',
            dataType: 'json',
            contentType:'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function() {
            alert('ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function (error) {
            alert(JSON.stringify(error));
        });
    },
    update : function() {
        var data = {
            title: $('#title').val(),
            content: $('#content').val()
        };

        var id = $('#id').val();

        $.ajax({
            type: 'PUT',
            url: '/api/v1/posts/' + id,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function(){
            alert('ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function() {
            alert(JSON.stringify(error));
        });
    }
};

main.init();
```

ì²«ë¬¸ì¥ì— `var main = { .. }` ë¼ëŠ” ë³€ìˆ˜ì˜ ì†ì„±ìœ¼ë¡œ functionì„ ì¶”ê°€í•œ ì´ìœ ê°€ ë­˜ê¹Œ?

ë§Œì•½ ê°™ì€ í™”ë©´ì—ì„œ **ë˜ë‹¤ë¥¸ a.js**ê°€ ì¶”ê°€ë˜ì–´ init, save, update functionì´ ìˆë‹¤ë©´

ë¸Œë¼ìš°ì €ì˜ ìŠ¤ì½”í”„ëŠ” ê³µìš© ê³µê°„ìœ¼ë¡œ ì“°ì´ê¸° ë•Œë¬¸ì— **ë‚˜ì¤‘ì— ë¡œë”©ëœ jsì˜ functionë“¤ì´ ë¨¼ì € ë¡œë”©ëœ jsì˜ functionì„ ë®ì–´ì“°ê²Œ ëœë‹¤.**

ì—¬ëŸ¬ ì‚¬ëŒì´ ì°¸ì—¬í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œëŠ” ì¤‘ë³µëœ í•¨ìˆ˜ëª…ì´ ìˆì„ í™•ë¥ ì´ ë†’ìœ¼ë¯€ë¡œ **index.jsë§Œì˜ ìœ íš¨ë²”ìœ„(scope)**ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

### ì¤‘ë³µëœ ì½”ë“œ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë¹¼ê¸°(ë¡œê·¸ì¸ëœ ì„¸ì…˜ ì •ë³´)

```jsx
@GetMapping("/")
    public String index(Model model) {
        model.addAttribute("posts", postsService.findAllDesc());

        SessionUser user = (SessionUser) httpSession.getAttribute("user");

        if(user != null){
            model.addAttribute("userName", user.getName());
        }

        return "index";
    }
```

ë§Œì•½ ë¡œê·¸ì¸ ì •ë³´ê°€ í•„ìš”í•œ í™”ë©´ì´ ì—¬ëŸ¬ê°œë¼ë©´

`SessionUser user = (SessionUser) httpSession.getAttribute("user");`

ìœ„ ì†ŒìŠ¤ë¥¼ ê³„ì† ë°˜ë³µí•´ì¤˜ì•¼ í•œë‹¤.

ì´ ë¶€ë¶„ì„ ë©”ì†Œë“œ ì¸ìë¡œ ì„¸ì…˜ê°’ì„ ë°”ë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ ë³€ê²½í•´ ë³´ì.

1. **ì–´ë…¸í…Œì´ì…˜ ìƒì„±**

```java
@Target(ElementType.PARAMETER) //ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ì˜¤ ì„ ì–¸ëœ ê°ì²´ì—ì„œë§Œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
@Retention(RetentionPolicy.RUNTIME)
public @interface LoginUser {
}
```

- **@Target(ElementType.PARAMETER)**
    - ì´ ì–´ë…¸í…Œì´ì…˜ì´ ìƒì„±ë  ìˆ˜ ìˆëŠ” ìœ„ì¹˜ë¥¼ ì§€ì •
    - PARAMETERë¡œ ì§€ì •í–ˆìœ¼ë‹ˆ ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ë¡œ ì„ ì–¸ëœ ê°ì²´ì—ì„œë§Œ ì‚¬ìš©ê°€ëŠ¥
- **@Interface**
    - ì´ íŒŒì¼ì„ ì–´ë…¸í…Œì´ì…˜ í´ë˜ìŠ¤ë¡œ ì§€ì •
    - LoginUserë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì–´ë…¸í…Œì´ì…˜ì´ ìƒì„±ëœ ê²ƒ

2. **LoginUserArgumentResolver ìƒì„±**

```java
@RequiredArgsConstructor
@Component
public class LoginUserArgumentResolver implements HandlerMethodArgumentResolver {

    private final HttpSession httpSession;

    //ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ íŠ¹ì • íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì›í•˜ëŠ”ì§€ íŒë‹¨í•˜ëŠ” ë©”ì„œë“œ
    //íŒŒë¼ë¯¸í„°ì— @LoginUser ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆê³ , íŒŒë¼ë¯¸í„° í´ë˜ìŠ¤ íƒ€ì…ì´ SessionUser.classì¸ ê²½ìš° trueë°˜í™˜
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        boolean isLoginUserAnnotation = parameter.getParameterAnnotation(LoginUser.class) != null;
        boolean isUserClass = SessionUser.class.equals(parameter.getParameterType());
        return isLoginUserAnnotation & isUserClass;
    }

    //íŒŒë¼ë¯¸í„°ì— ì „ë‹¬í•  ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
    //ì—¬ê¸°ì„œëŠ” ì„¸ì…˜ì—ì„œ ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    @Override
    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {
        return httpSession.getAttribute("user");
    }
}
```

ê°™ì€ ìœ„ì¹˜ì— `LoginUserArgumentResolver`ë¥¼ ìƒì„±í•œë‹¤.

- `HandlerMethodArgumentResolver` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤

â“**HandlerMethodArgumentResolver**

ì¡°ê±´ì— ë§ëŠ” ê²½ìš° ë©”ì†Œë“œê°€ ìˆë‹¤ë©´ `HandlerMethodArgumentResolver`ì˜ êµ¬í˜„ì²´ê°€ ì§€ì •í•œ ê°’ìœ¼ë¡œ í•´ë‹¹ ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸¸ ìˆ˜ ìˆë‹¤.

3. **WebConfig ìƒì„±**

```java
@RequiredArgsConstructor
@Configuration
public class WebConfig implements WebMvcConfigurer {
    private final LoginUserArgumentResolver loginUserArgumentResolver;

    //HandlerMethodArgumentResolverëŠ” í•­ìƒ WebMvcConfigurerì˜ addArgumentResolvers()ë¥¼ í†µí•´ ì¶”ê°€í•´ì•¼ í•œë‹¤.
    //ë‹¤ë¥¸ HandlerMethodArgumentResolverê°€ í•„ìš”í•˜ë©´ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì¶”ê°€í•´ ì£¼ë©´ ëœë‹¤.
    @Override
    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
        resolvers.add(loginUserArgumentResolver);
    }
}
```

`LoginUserArgumentResolver`ê°€ ìŠ¤í”„ë§ì—ì„œ ì¸ì‹ë  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•´ì£¼ëŠ” ê²ƒ

### ê²°ê³¼

```java
@GetMapping("/")
public String index(Model model, **@LoginUser SessionUser user**) {
    model.addAttribute("posts", postsService.findAllDesc());

    if(user != null){
        model.addAttribute("userName", user.getName());
    }

    return "index";
}
```

`@LoginUser SessionUser user` ë¡œ ëŒ€ì²´ë˜ì—ˆë‹¤!

### Git Action
![[IMG-20250203175817786.png]]