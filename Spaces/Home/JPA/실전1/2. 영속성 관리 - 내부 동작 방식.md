### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸

<aside> ğŸ’¡ JPAì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ 2ê°€ì§€

</aside>

- ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ë§¤í•‘í•˜ê¸°(Object Relational Mapping)
    
- **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸**
    
    : â€˜ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½â€™ì´ë¼ëŠ” ëœ»
    
    : EntityManager.persist(entity);
    

> **ì—”í‹°í‹° ë§¤ë‹ˆì €? ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸?**

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ë…¼ë¦¬ì ì¸ ê°œë…
- ëˆˆì— ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.
- ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼

> **ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸°**

- **ë¹„ì˜ì† (new/transient)**
    
    ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì „í˜€ ê´€ê³„ê°€ ì—†ëŠ” ìƒˆë¡œìš´ ìƒíƒœ
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/484b5db1-6126-4aad-a0fb-cf7bcde22747/Untitled.png)
    
- **ì˜ì† (managed)**
    
    ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê´€ë¦¬ë˜ëŠ” ìƒíƒœ
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3a1d212f-55cb-4d8c-8875-754afdb54c1d/Untitled.png)
    
- **ì¤€ì˜ì† (detached)**
    
    ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ë˜ì—ˆë‹¤ê°€ ë¶„ë¦¬ëœ ìƒíƒœ
    
- **ì‚­ì œ (removed)**
    
    ì‚­ì œëœ ìƒíƒœ
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f0734356-fc73-456f-903f-4768048c0897/Untitled.png)
    

> **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì´ì **

â€¢ 1ì°¨ ìºì‹œ

ex) ê³ ê°ì´ ë™ì‹œì— 10ëª…ì´ ì ‘ê·¼í•˜ë©´ ë‹¤ ë³„ë„ì˜ 1ì°¨ ìºì‹œë¥¼ ê°€ì§„ë‹¤. (ì„±ëŠ¥ë³´ë‹¤ëŠ” ë§¤ì»¤ë‹ˆì¦˜ì˜ ì´ì ì´ ì¡´ì¬)

â€¢ ë™ì¼ì„±(identity) ë³´ì¥

1ì°¨ ìºì‹œì—ì„œ ê°€ì ¸ì˜¨ ê±¸ ì‚¬ìš©í•œë‹¤.

â€¢ íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—° (transactional write-behind)

wirteë¥¼ ëª¨ì•˜ë‹¤ê°€ í•œë²ˆì— writeí•˜ëŠ” ê²ƒ

â€¢ ë³€ê²½ ê°ì§€ (Dirty Checking)

JPAê°€ ìë™ìœ¼ë¡œ ë³€ê²½ì„ ê°ì§€ í•˜ëŠ” ê²ƒ

[ë”í‹° ì²´í‚¹ (Dirty Checking)ì´ë€?](https://jojoldu.tistory.com/415)

â€¢ ì§€ì—° ë¡œë”© (Lazy Loading)

> **ì—”í‹°í‹° ì¡°íšŒ, 1ì°¨ ìºì‹œ**

persist() í•˜ëŠ” ìˆœê°„ ë°”ë¡œ ì¿¼ë¦¬ê°€ ë‚ ì•„ê°€ëŠ”ê²Œ ì•„ë‹ˆë¼ 1ì°¨ ìºì‹œì— ì €ì¥í•´ë†“ëŠ”ë‹¤.

â†’ ì˜ì†ìƒíƒœê°€ ëœë‹¤.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a5635ff9-638e-47f4-a8b1-139498ce7858/Untitled.png)

> **1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒ**

persist í›„ ë°”ë¡œ ì¡°íšŒí•˜ë©´ 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒí•œë‹¤.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6535658f-c9c9-4420-bd74-d3a58e328cfa/Untitled.png)

> **ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8d8b7612-9a2e-4de8-8bf6-2d47558ca6b9/Untitled.png)

> **em.persist() ì˜ ê³¼ì •**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4aa9b6de-c005-49aa-8aa7-a59dab2ffd3e/Untitled.png)

commití•˜ë©´ insert ì¿¼ë¦¬ ì „ì†¡

commití•˜ë©´ ëª¨ì•„ë†¨ë˜ insertì¿¼ë¦¬ë¥¼ DBì— ì „ì†¡í•œë‹¤.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4699b586-06ac-4cc0-950e-6df2aa9431ff/Untitled.png)

### í”ŒëŸ¬ì‹œ

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë‚´ìš©ì„ DBì— ë‚ ë ¤ì£¼ëŠ” ê²ƒ
- commití•˜ê¸°ì „ì— ê°•ì œë¡œ ë‚ ë¦¬ëŠ” ê²ƒ

> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•˜ëŠ” ë°©ë²•

1. **em.flush()** - ì§ì ‘ í˜¸ì¶œ(ì›¬ë§Œí•˜ë©´ ìë™ í˜¸ì¶œ ê¶Œì¥)
    
    ```java
    //ì˜ì†
    Member member = new Member(200L, "member200");
    em.persist(member);
    
    **em.flush();**
    
    System.out.println("=================");
    tx.commit();
    ```
    
2. **íŠ¸ëœì­ì…˜ ì»¤ë°‹** - í”ŒëŸ¬ì‹œ ìë™ í˜¸ì¶œ
    

### ì¤€ì˜ì† ìƒíƒœ

- ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬(detached)
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš© ëª»í•¨

> ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“œëŠ” ë°©ë²•

1. **em.detach(entity)** íŠ¹ì • ì—”í‹°í‹°ë§Œ ì¤€ì˜ì† ìƒíƒœë¡œ ì „í™˜
    
    ```java
    //ì˜ì†
    Member member1 = em.find(Member.class, 200L);
    member1.setName("AAA");
    
    //ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“¦
    em.detach(member1);
    
    System.out.println("=================");
    //commití•´ë„ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŒ.
    tx.commit();
    ```
    
2. **em.clear()**
    

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì™„ì „íˆ ì´ˆê¸°í™”
    
    ```java
    //ì˜ì†
    Member member1 = em.find(Member.class, 200L);
    member1.setName("AAA");
    
    em.clear();
    
    Member member2 = em.find(Member.class, 200L);
    
    System.out.println("=================");
    tx.commit();
    ```
    
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì´ˆê¸°í™” ëê¸° ë•Œë¬¸ì— selectë¬¸ì´ 2ë²ˆ ë‚˜ê°
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b1477128-4d71-49b3-97ca-b35c35fa30d5/Untitled.png)
    

1. **em.close()** ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œ