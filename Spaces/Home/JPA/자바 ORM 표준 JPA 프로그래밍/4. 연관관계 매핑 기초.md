## ì—°ê´€ê´€ê³„ê°€ í•„ìš”í•œ ì´ìœ 

ê°ì²´ì§€í–¥ ì„¤ê³„ì˜ ëª©í‘œëŠ” ììœ¨ì ì¸ ê°ì²´ë“¤ì˜ **í˜‘ë ¥ ê³µë™ì²´**ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤.

## ìš©ì–´ ì´í•´
- ë°©í–¥(Direction): ë‹¨ë°©í–¥, ì–‘ë°©í–¥
- ë‹¤ì¤‘ì„±(Multiplicity): ë‹¤ëŒ€ì¼(N:1), ì¼ëŒ€ë‹¤(1:N), ì¼ëŒ€ì¼(1:1), ë‹¤ëŒ€ë‹¤(N:M) ì´í•´
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner): ê°ì²´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ëŠ” ì£¼ì¸ì´ í•„ìš”

## ì˜ˆì œ ì‹œë‚˜ë¦¬ì˜¤
- íšŒì›ê³¼ íŒ€ì´ ìˆë‹¤.
- íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.
- íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤.

### ğŸ™…â€â™€ï¸ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§í•œ ì˜ˆ
![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325163928657.webp|473]]
ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§(ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ê°ì²´)
```java
@Entity
 public class Member {
		 @Id @GeneratedValue
		 private Long id;

		 @Column(name = "USERNAME")
		 private String name;

		 @Column(name = "TEAM_ID")
		 private Long teamId;
}

		 @Entity
		 public class Team {

		 @Id @GeneratedValue
		 private Long id;

		 private String name;
 }
```

ì°¸ì¡° ëŒ€ì‹ ì— ì™¸ë˜í‚¤ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
```java
//íŒ€ ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

//íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1");
**member.setTeamId(team.getId()); //ì™¸ë˜í‚¤ë¥¼ ì§ì ‘ ì‚¬ìš©**
em.persist(member);

//íšŒì›ì˜ ì†Œì† íŒ€ì„ ì¡°íšŒí•  ë•Œ
Member findMember = em.find(Member.class,member.getId());
Long findTeamId = findMember.getTeamId();
Team findTeam = em.find(Team.class, findTeamId); 
```

= ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ë¸ë§í•˜ë©´, **í˜‘ë ¥ ê´€ê³„**ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë‹¤

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„
![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325164008311.webp|526]]
Member.classì— teamìì²´ë¥¼ í¬í•¨

```java
@Entity
public class Member {
	@Id @GeneratedValue
	private Long id;
	
	@Column(name = "USERNAME")
	private String name;
	
	private int age;
	
	@ManyToOne
	@JoinColumn(name = "TEAM_ID")
	private Team team;
}
```

```java
//íŒ€ ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

//íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1");
member.setTeam(team); **//ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •, ì°¸ì¡° ì €ì¥**
em.persist(member);

//íšŒì›ì˜ ì†Œì† íŒ€ì„ ì¡°íšŒí•  ë•Œ
Member findMember = em.find(Member.class, member.getId());
//ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ ì¡°íšŒ
Team findTeam = findMember.getTeam();
```

**ì—°ê´€ê´€ê³„ ìˆ˜ì •**
```java
// ìƒˆë¡œìš´ íŒ€B
Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);

// íšŒì›1ì— ìƒˆë¡œìš´ íŒ€B ì„¤ì •
member.setTeam(teamB);
```
íŒ€ì´ ì¶”ê°€ë˜ë”ë¼ë„ teamì„ êº¼ë‚´ì„œ ìˆ˜ì •í•˜ì§€ ì•Šê³ , **memberì— setë§Œ í•´ì£¼ë©´ ìˆ˜ì •ì´ ê°€ëŠ¥**í•˜ë‹¤.

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325164106499.webp|516]]

**ì–‘ë°©í–¥ ë§¤í•‘**

```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
}
```

Member ì—”í‹°í‹°ëŠ” ë‹¨ë°©í–¥ê³¼ ë™ì¼í•˜ë‹¤.

```java
@Entity
public class Team {
    @Id
    @GeneratedValue
    @Column(name="TEAM_ID")
    private Long id;

    private String name;

    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<>(); //ê´€ë¡€ë¡œ ArrayListë¡œ ì´ˆê¸°í™”í•´ë‘ 
}
```

Team ì—”í‹°í‹°ì— ì»¬ë ‰ì…˜ ì¶”ê°€

```java
//íŒ€ ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

//íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1");
member.setTeam(team); 
em.persist(member);

em.flush();
em.clear();

//íšŒì› ì¡°íšŒ
Member findMember = em.find(Member.class, member.getId());
//íŒ€ ë©¤ë²„ ì¡°íšŒ
List<Member> members = findMember.getTeam().getMembers();
```
ë°˜ëŒ€ ë°©í–¥(`getTeam().getMembers()`)ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤.

## ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ê³¼ mappedBy

> [!TIP] ê°ì²´ì™€ í…Œì´ë¸”ê°„ì— ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤.


![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325164300455.webp|500]]

ğŸŸ¨ **ê°ì²´ ì—°ê´€ê´€ê³„ = 2ê°œ**
1. íšŒì› â†’ íŒ€ ì—°ê´€ê´€ê³„ 1ê°œ(ë‹¨ë°©í–¥)
2. íŒ€ â†’ íšŒì› ì—°ê´€ê´€ê³„ 1ê°œ(ë‹¨ë°©í–¥)
	
ğŸŸ© **í…Œì´ë¸” ì—°ê´€ê´€ê³„ = 1ê°œ**
1. íšŒì› â†” íŒ€ì˜ ì—°ê´€ê´€ê³„ 1ê°œ(ì–‘ë°©í–¥)

ğŸŸ¨**ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„**
- ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„ëŠ” ì‚¬ì‹¤ ì–‘ë°©í–¥ ê´€ê³„ê°€ ì•„ë‹ˆë¼ **ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ê´€ê³„ 2ê°œ**ë‹¤.
- ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
```java
class A {
	B b;
}

class B{
	A a;
}

a.getB();
b.getA();
```

ğŸŸ© **í…Œì´ë¸”ì˜ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„**
- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•œë‹¤.
![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325164730203.webp|552]]

MEMBER.TEAM_ID **ì™¸ë˜ í‚¤ í•˜ë‚˜**ë¡œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ê°€ì§(ì–‘ìª½ìœ¼ë¡œ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.)
```sql
SELECT *
FROM MEMBER M
JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID

SELECT *
FROM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
```
        
## ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)
![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325164813621.webp|500]]

> [!NOTE] ë©¤ë²„ë¥¼ ë°”ê¾¸ê³ ì‹¶ê±°ë‚˜ ìƒˆë¡œìš´ íŒ€ì— ë“¤ì–´ê°€ê³  ì‹¶ì„ ë•Œ Member.teamì„ ë°”ê¿”ì•¼ í•˜ëŠ”ì§€
> Team. membersë¥¼ ë°”ê¿”ì•¼ í•˜ëŠ”ì§€ ì´ìƒí•¨..! DBì…ì¥ì—ì„  team_id ê°’ë§Œ ë°”ë€Œë©´ ëœë‹¤!
> = ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)ë¥¼ ì§€ì •í•´ì•¼ í•œë‹¤.


## ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™
> [!NOTE]
> - ê°ì²´ì˜ ë‘ ê´€ê³„ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •
> - **ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì„ ì£¼ì¸ìœ¼ë¡œ ì •í•´ë¼**
> - **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)**
> - **ì£¼ì¸ì´ ì•„ë‹Œìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥.**
> - ì£¼ì¸ì€ mappedBy ì†ì„± ì‚¬ìš©X, ë°˜ëŒ€í¸ì´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •

## ì–‘ë°©í–¥ ë§¤í•‘ ì‹œ ê°€ì¥ ë§ì´ í•˜ëŠ” ì‹¤ìˆ˜


**before**
```java
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

//ì—­ë°©í–¥(ì£¼ì¸ì´ ì•„ë‹Œ ìª½)ì—ë§Œ ì—°ê´€ê´€ê³„ ì„¤ì •
team.getMembers().add(member);      //**

em.persist(member);
```
![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325165204860.webp|200]]

**after**
```java
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

//ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•´ì•¼ í•œë‹¤.
member.setTeam(team);      //**

em.persist(member);
```
![[4. ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ-20240325165220278.webp|300]]

> [!CAUTION] ìˆœìˆ˜ ê°ì²´ ìƒíƒœë¥¼ ê³ ë ¤í•´ì„œ í•­ìƒ ì–‘ìª½ì— ê°’ì„ ì„¤ì •í•˜ì

```java
//team ì €ì¥
Team team =  new Team();
team.setName("teamA");
em.persist(team);

//member ì €ì¥
Member member = new Member();
member.setUsername("member1");
member.setTeam(team); //ì£¼ì¸ì— team ì„¤ì •
em.persist(member);

//team.getMembers().add(member); << ì–‘ìª½ì— í•˜ì§€ ì•Šìœ¼ë©´

//em.flush();
//em.clear();

//ì•„ë¬´ê²ƒë„ ì¡°íšŒë˜ì§€ ì•ŠìŒ = teamì€ ìˆœìˆ˜ ê°ì²´ ìƒíƒœê¸° ë•Œë¬¸
Team findTeam = em.find(Team.class, team.getId());  //1ì°¨ ìºì‹œì— ì—†ëŠ” ìƒíƒœ
List<Member> members = findTeam.getMembers();
for (Member m : members) {
    System.out.println("m.getUsername() = " + m.getUsername());
}

tx.commit();
```

> [!CAUTION] ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ì

Member í´ë˜ìŠ¤ì—ì„œ `setTeam()` ë©”ì†Œë“œ ëŒ€ì‹  ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ìƒì„±í•˜ë©´
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ `team.getMembers().add(member);` ì´ì™€ ê°™ì€ ì²˜ë¦¬ë¥¼ ì•ˆí•´ì¤˜ë„ ë¨.

```java
@Entity
public class Member {
	@ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;

		public void changeTeam(Team team) {
        this.team = team;

        //ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ
        team.getMembers().add(this);
    }
}
```

> [!CAUTION] ì–‘ë°©í–¥ ë§¤í•‘ì‹œì— ë¬´í•œ ë£¨í”„ë¥¼ ì¡°ì‹¬í•˜ì ex) toString(), lombok, JSON ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬

```java
@Override
public String toString() {
    return "Member{" +
            "id=" + id +
            ", username='" + username + '\\'' +
            ", team=" + team + //team.toString(); í˜¸ì¶œë˜ë©´ì„œ ì„œë¡œ ê³„ì† í˜¸ì¶œ
            '}';
}
```

## ì–‘ë°©í–¥ ë§¤í•‘ ì •ë¦¬
- ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œë„ ì´ë¯¸ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì™„ë£Œ
    DBì—ì„œ ì™¸ë˜í‚¤ ì¶”ê°€(ë‹¨ë°©í–¥)ë§Œìœ¼ë¡œ ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ ëœ ê²ƒì´ë¯€ë¡œ..
- ì–‘ë°©í–¥ ë§¤í•‘ì€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì¡°íšŒ(ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰) ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ê²ƒ ë¿
- JPQLì—ì„œ ì—­ë°©í–¥ìœ¼ë¡œ íƒìƒ‰í•  ì¼ì´ ë§ë‹¤.
- ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì˜ í•˜ê³  **ì–‘ë°©í–¥ì€ í•„ìš”í•  ë•Œ ì¶”ê°€í•´ë„ ë¨(í…Œì´ë¸”ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ)**
