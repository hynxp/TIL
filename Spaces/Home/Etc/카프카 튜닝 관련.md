카프카

> 메시지의 크기가 평균 1MB 이고, 브로커의 메모리 크기 1GB. 초당 발행 메시지 수 평균 10,000개, 컨슈머 1개당 처리 속도 1초에 1000개 일 경우 kafka를 어떻게 튜닝하면 좋을까요?


알겠지만 kafka는 메시지 큐잉하는 프레임웤이고 메시지 큐잉한다는거는 예를들어 앱에서 나오는 이벤트들을 db에 넣는 다 할때 중간에 카프카가 껴서 이벤트 데이터를 가지고있는그런역할임

결론적으로 튜닝을 어케해야하냐라고 하면 정답은 없다가 결론은 없다가 전제인데 물론 엔지니어 관점 암튼 이런 상황일 때 튜닝법은 단순히 브로커 메모리 올리는게 답이다

메시지 크기가 1mb고 초당 1만개나온다는거자체가 초당 10000mb = 10gb인데 말인안된다생각함 그걸 받는 카프카 브로커메모리가 1gb이면 1초에 바로 터진다는 걸로 이해돼서 나는 
그리고 브로커"들"말고 브로커라고 하셨으니 1gb의 메모리를 가진 브로커가 한대인건지도 알아야할듯 카프카 같은 애들은 무조건 3대 이상 묶어서 한대 죽어도 다른 두대가 일하는게 기본 개념이라 만약 브로커 한대고 면접가면 왜 한대로했냐 클러스터안하고 라는 질문나올거같아서 말함

1. 만약 진짜 초당 1mb *10000건이면 단순 계산으로도 1gb메모리가진애가 못버티지않을가라는 의문

2. 진짜 초당 저렇게 나온다면 브로커 메모리 올리는게 무조건 필수임

3. 카프카는 기본적으로 3대로 구성하는게 현업 룰임 그래야 한대 죽어도 다른 두대가 일해서 안정성이 보장되니까
	1. 3대가 기본이라는게 1gb서버를 0.3 *3으로 나누는게아니라 1gb *3대 서버로 구성한다는 거임 근데 서버가 없다면 별 수 없음 프로듀싱하는 메시지의 크기나 발행 주기를 늦추거나 아님 나도 안해봤지만 메시지 청크라고 한 메시지를 분할해서 보내는게있다고 들음

4. 챗지피티가 답변한 파티셔닝 같은 튜닝도 정말 중요함, db에 파티셔닝 처럼 (물론 디스크 메모리 튜닝은 비교 대상이 아니지만) 성능 향상에 중요포인트임, 이것도 알면 좋지만 지금 상황을 봤을 땐 브로커 메모리부터 올리고 그뒤에 고민해야함

5. 위 4번으로 브로커 메모리를 올렸는데도 리소스 부족(뭐 테스트할 서버 메모리 용량이 없다거나)이 나온다면 

6. 브로커 여러대 구성하고 파티셔닝을 통해서 여러 브로커들이 메시지를 병렬적으로 큐잉하는 게 효과가 있을 거임

7. 마지막에 컨슈머 처리량을 말씀하셨는데, 컨슈머도 카프카로 되어있는지 모르겠음. 예를 들어서 메시지 발행 -> 카프카 브로커의 토픽 -> spark와 같은 처리 프레임웤이면 여기서 컨슈머는 spark이 되는거임. 근데 추측상 이 컨슈머도 카프카 컨슈머로 로직이 되어있을 것 같은데 암튼 중요한건 컨슈머 = 카프카는 아니라는 점

8. 7번을 설명한 까닭은 컨슈머도 카프카로 되어있든, 언급한 spark가 컨슈머가 됐는 중요한건 프로듀서 -> 카프카 브로커 토픽에 들어간 이상 컨슈머의 처리량은 전혀 무관하다는 것

9. 8번 상세히 설명하면 컨슈머가 카프카 브로커 토픽내 메시지를 소비한다고 브로커안에있는 더 정확히 브로커 메모리상에 있는 메시지가 없어지는게 아니라는 것 컨슈밍을 했든 안했든 토픽에 메시지는 남아있음

10. 9번 상황일 때 어 그럼 브로커 토픽 내 메시지는 언제 없어져요? 할수 있는데 이건 카프카 설치 할때 이름을 기억이 안나는데 컨피그 파일에 토픽 내 메시지 보관 주기를 설정하는 값이 있음



초당 평균10기가 가용가능한 메모리는 1기가 근데 이게 지금 스터디 내 플젝상황인거라 생각하고 약간 서버 용량 대비 거의 불가능한 처리량이다 그래서 메시지를 작게하던지 서버를 늘려서 메모리를 올려야할거다라는거였고

질문 취지를 알았고 발행되는 메시지양을 알고 서버 용량은 제한이 없다는 가정하에 어떻게 이 많은 메시지를 효율적으로 처리할가라는 아키텍처적인 질문이면

파티셔닝과컨슈머 개수를 바로 생각하는게맞음 Db에 많은데이터가 있는데 조회속도느릴때 파티셔닝 적재를 생각하는것처럼



Pub=메시지 발행주체, 카프카가 될수도 스프링으로만든 웹이 될수도

Broker=pub에서 나온 메시지를 토픽 저장하고 관리하는 주체

Sub=브로커가 관리하는 토픽  내 메시지를 읽는 주체

Kafka=broker oo

Kafka=pub xx
pub이 카프카가 될수도 있고 스프링이나 다른 주체가 될수있음

Kafka=sub xx 위랑 동일

처음 공부할때 kafka =pub
Kafka=sub 이라고 나도생각했고 헷갈리는게 kafka 첫 예제가 메시지 발행 구독을 둘다 kafka로 해서 그럼
Kafka-producer-console.sh kafka-consumer-console.sh였나 이런 스크립트로 자체 발행 구독해서