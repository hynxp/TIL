큐브리드는 네이버가 개발하고 네이버의 많은 서비스에 사용하는 DBMS다.  
국내 유일의 오픈 소스 DBMS로, 24시간 무정지 및 부하 분산을 위한 HA 기능을 **무료로 제공**하고 있으며, 시스템 증설을 위한 **라이선스 비용이 전혀 들지 않는다**.

## 큐브리드의 특징
### 3계층 구조
큐브리드는 **응용프로그램 – 브로커 – 데이터베이스 엔진**의 3계층 구조로 구성된다.  
기존 오라클이나 MySQL의 **응용프로그램 – 데이터베이스 엔진** 구성(2계층)에 비하면 낯설게 느껴질 수 있지만, 사용 목적에 따라 장점이 된다.

- 큐브리드는 질의를 처리하고 데이터베이스 볼륨을 저장하는 **데이터베이스 엔진**과
- 응용프로그램의 연결 요청을 처리하는 **브로커**를 **별도의 시스템으로 분리**하여 관리할 수 있다.
    

즉, **다중 브로커**와 **다중 데이터베이스 서버**를 유지할 수 있다.  
이러한 3계층 구조는 소규모 데이터를 운영한다면 오히려 **복잡하고 관리 지점이 늘어나는 단점**이 있지만,  
**동시 접속자 증가** 또는 **데이터 증가로 대량의 요청을 처리해야 하는 시점**에는 최소의 비용으로 수평 확장이 쉬운 구조다.

## 큐브리드 아키텍처 및 프로세스 구성
### 프로세스 구성 및 동작
![[IMG-20250704224627307.png]]

큐브리드를 실행하면 다음과 같은 프로세스가 시작된다

|프로세스|설명|
|---|---|
|cub_master|마스터 프로세스. 브로커와 서버 사이의 가교 역할을 한다.|
|cub_server|각 데이터베이스별로 실행되는 서버 프로세스. DB마다 1:1 대응된다.|
|cub_broker|브로커 프로세스. 응용프로그램과 서버를 연결해주는 역할을 한다.|
|cub_cas_*|브로커에 속한 CAS(Connection Agent Server) 프로세스. 실제로 SQL을 실행하는 곳이다.|
|cub_cmserver|큐브리드 매니저(CUBRID Manager)용 프로세스. GUI 도구에서 질의 실행, 백업, 복구 등을 담당한다.|
예시로 `ps -ef | grep cub_` 명령을 실행하면 위 프로세스들을 확인할 수 있다.


### 응용프로그램이 서버에 연결되는 과정

![[IMG-20250704234312025.png]]
1. 응용프로그램이 브로커 프로세스에 연결 요청 → 브로커는 CAS를 할당
2. 응용프로그램과 CAS 프로세스가 연결
3. CAS가 마스터 프로세스에 연결 요청 → 마스터는 서버 프로세스에 연결
4. 최종적으로 `응용프로그램 – CAS – 서버 프로세스` 연결이 성립됨

이후 데이터베이스 접속이 종료되기 전까지 위의 3자 연결이 유지된다.  
즉, 큐브리드의 프로세스는 응용프로그램, 브로커(CAS), 서버 프로세스로 구성되는 **3계층 구조**이다.

### 리눅스에서 큐브리드 프로세스 확인 예시
```
ps -ef | grep cub_
```

이 명령어를 사용하면 다음과 같은 프로세스들이 확인된다
![[IMG-20250704234505067.png]]

| 프로세스명                    | 설명                                    |
| ------------------------ | ------------------------------------- |
| cub_master               | 마스터 프로세스                              |
| cub_server demodb        | `demodb`라는 데이터베이스 전용 서버 프로세스          |
| cub_broker               | 브로커 프로세스, 설정 파일 기반으로 여러 개 생성됨         |
| query_editor_cub_cas_1~5 | query_editor 브로커에서 구동 중인 5개의 CAS 프로세스 |
| broker1_cub_cas_1~5      | broker1 브로커에서 구동 중인 5개의 CAS 프로세스      |
| cub_cmserver             | 큐브리드 매니저 GUI용 서버 프로세스                 |


## 데이터베이스 볼륨 구조
큐브리드의 데이터베이스 볼륨은 저장 형태에 따라 다음과 같이 나뉜다

- **영구 볼륨 (permanent volume)**: 삭제 전까지 유지됨
- **일시적 볼륨 (temporary volume)**: 쿼리 중간 결과 저장용, 재시작 시 삭제됨
- **백업 볼륨 (backup volume)**: 백업 시 생성되는 스냅샷 데이터

영구 볼륨은 다시 다음과 같이 세분화된다

| 볼륨 종류  | 설명                               |
| ------ | -------------------------------- |
| 범용 볼륨  | 스키마, 인덱스, 데이터를 모두 저장. 기본 볼륨      |
| 데이터 볼륨 | 데이터 저장 전용                        |
| 인덱스 볼륨 | 인덱스 저장 전용                        |
| 임시 볼륨  | 정렬, 중간 결과 저장. 영구 볼륨이므로 재시작해도 유지됨 |

> 임시 볼륨 공간이 모두 소진되면 일시적 볼륨이 사용된다.


### 볼륨 생성 예시
```
cubrid createdb --db-volume-size=512M --log-volume-size=256M cubriddb ko_KR.utf8 
cubrid addvoldb -S -p data -n cubriddb_DATA01 --db-volume-size=512M cubriddb 
cubrid addvoldb -S -p data -n cubriddb_DATA02 --db-volume-size=512M cubriddb 
cubrid addvoldb -S -p index -n cubriddb_INDEX01 cubriddb --db-volume-size=512M cubriddb 
cubrid addvoldb -S -p temp -n cubriddb_TEMP01 cubriddb --db-volume-size=512M cubriddb
```

![[IMG-20250704234553750.png]]


## 데이터베이스 서버 설정
큐브리드 서버와 관련된 파라미터는 cubrid.conf 파일에서 설정한다.

| 섹션           | 설명                                        |
| ------------ | ----------------------------------------- |
| [service]    | 큐브리드 서비스 시작에 관련된 파라미터                     |
| [common]     | 전체 DB에 공통 적용                              |
| [@데이터베이스명]   | DB별 개별 설정                                 |
| [standalone] | stand-alone 모드에서 사용되는 파라미터 (ex: loaddb 등) |

### 주요 파라미터 설명
- **data_buffer_size**: 캐싱되는 데이터 버퍼 크기 (메모리의 40~60% 추천)
    
- **log_buffer_size**: 로그 버퍼 크기
    
- **sort_buffer_size**: 정렬용 버퍼. 정렬 쿼리 또는 인덱스 생성 시 사용됨
    
- **max_clients**: 서버에 동시 접속 가능한 클라이언트 수
    
- **cubrid_port_id**: 마스터와 브로커가 통신할 때 사용하는 포트
    
- **log_max_archives**: 보관 로그 최대 개수. 복구 필요 시 보관 로그가 유지되어야 함


> 데이터베이스 서버를 설정할 때 가장 유의해야 하는 것은 data_buffer_size 파라미터와 max_clients 파라미터다. 네이버 표준 data_buffer_size 파라미터값은 메모리 영역의 40~60% 정도다. 필요에 따라 60% 이상으로 설정 하는 경우가 있는데, 다른 영역에서도 메모리를 사용해야 하므로 극단적으로 높게 설정하는 것은 피해야 한다. CUBRID 서버 프로세스에 접속 가능한 클라이언트 개수인 max_clients 파라미터값 또한, 설정할수록 메모리 사용 량이 증가하므로 적절한 값을 설정해야 한다. 네이버에서는 max_clients 파라미터값을 1024로 설정한다.

