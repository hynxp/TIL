네트워크 통신에서 발생할 수 있는 여러 종류의 타임아웃 중 `Connection Timeout`, `Socket Timeout`, 그리고 `Read Timeout`은 서로 다른 상황에서 발생하며 각각의 역할과 필요성이 있다. 
이를 자세히 살펴보자.

## Connection Timeout이란?
Connection Timeout은 클라이언트가 서버에 연결을 시도할 때 일정 시간 내에 연결이 완료되지 않으면 발생한다. 이는 TCP 소켓 통신에서 **3-way-handshake가 특정 시간 내에 완료되지 않을 때 발생**하는 문제다.

### Connection Timeout이 발생하는 상황
1. 서버가 다운되었거나 네트워크에 문제가 있을 때
2. 서버의 응답 시간이 과도하게 길어질 때
3. 방화벽 또는 네트워크 정책으로 인해 연결이 차단되었을 때


## Socket Timeout이란?
Socket Timeout은 Connection Timeout 이후 클라이언트와 서버가 연결된 상태에서 발생할 수 있는 타임아웃이다. 이는 데이터가 패킷 단위로 전송될 때**, 특정 패킷이 일정 시간 내에 도착하지 않을 경우 발생**한다.

### Socket Timeout이 필요한 이유
1. 네트워크 지연으로 인해 일부 패킷이 전송되지 않으면, 전체 통신이 중단될 위험이 있다.
2. 빠른 실패(fail-fast)를 통해 다른 작업을 진행할 수 있다.


## Read Timeout이란?
Read Timeout은 **클라이언트와 서버 간의 I/O 작업이 특정 시간 내에 완료되지 않을 때 발생**한다. 서버가 데이터를 보내거나 작업 결과를 응답하지 않으면 클라이언트는 연결을 종료한다.

### Read Timeout의 필요성
1. 서버 응답이 느릴 때 무한 대기를 방지한다.
2. 클라이언트 자원의 낭비를 최소화할 수 있다.


## 네트워크 통신에 타임아웃이 필요한 이유
타임아웃은 시스템 자원을 효율적으로 관리하기 위해 필수적이다. 
무한정 기다리거나 응답을 대기하는 상태가 길어질 경우, 자원이 고갈되어 전체 시스템에 장애가 발생할 수 있다. 
타임아웃을 통해 다음과 같은 문제를 방지할 수 있다

- 요청이 무한정 대기 상태로 남는 상황 방지
- 병목 현상으로 인한 서비스 성능 저하 최소화
- 빠른 실패를 통해 효율적인 장애 처리 가능


## 타임아웃 테스트는 어떻게 할 수 있을까?
타임아웃 설정이 제대로 작동하는지 확인하려면 테스트 환경을 구축해야 한다. 가상 서버를 띄우고 고의로 지연을 추가하거나 방화벽 규칙을 수정하여 다양한 상황을 시뮬레이션할 수 있다.

테스트 환경 구축에는 시간이 소요될 수 있지만, 타임아웃 설정을 테스트하는 것은 매우 중요하다. 
특히 대규모 서비스에서 적절한 타임아웃 설정은 장애를 방지하고 사용자의 경험을 개선하는 데 필수적이다. 다만 테스트의 복잡도와 비용을 고려해 적절한 테스트 계획을 수립하는 것이 필요하다.

타임아웃 설정은 네트워크 안정성과 사용자 경험을 보장하는 중요한 요소로, 상황에 맞는 적절한 설정과 테스트가 중요하다.


참고
[토스페이먼츠 - 타임아웃](https://docs.tosspayments.com/resources/glossary/timeout)
[성공/실패를 단언할 수 없는 네트워크 에러 안전하게 다루기](https://hudi.blog/safely-handling-network-errors/)