운영체제는 사용자를 위한 프로그램이 아니라, 사용자가 실행하는 프로그램을 위한 프로그램이다.
프로그램을 위한 프로그램이라... 도르마무...
![[IMG-20250211165203695.png|300]]
즉, 사용자가 실행하는 응용 프로그램이 올바르게 실행되도록 필요한 자원을 할당해 주는 프로그램이다!

그런 운영체제에서 심장이라고 불리는 아주 핵심 개념이 커널이다.
응용 프로그램이 운영체제로부터 어떻게 도움을 받으며 실행되는지 이해하기 위해 이중 모드와 시스템 호출(`System Call`)이라는 개념을 알아보자!

## 커널이란?
![[IMG-20250211165203744.png|300]]
운영체제가 응용 프로그램에 제공하는 서비스 종류는 다양하지만, 그중에서도 가장 중요한 서비스가 있다.
**자원에 접근하고 조작하는 기능, 그리고 프로그램이 안전하게 실행되도록 하는 기능**이 바로 그것이다.

이런 **핵심 서비스를 담당하는 부분을** 커널(`kernel`)이라고 한다.

운영체제가 설치된 모든 기기에는 커널이 존재하며, 이는 컴퓨터의 심장 또는 자동차의 엔진과도 같다. 어떤 커널을 사용하는지에 따라 프로그램이 하드웨어를 활용하는 방식이 달라지고, 결과적으로 시스템 성능에도 영향을 미친다.

대부분의 운영체제 전공서는 운영체제의 핵심 부분을 설명하는데, 특별한 언급이 없으면 운영체제를 곧 **커널**이라고 봐도 무방하다.

### 사용자 인터페이스(User Interface)
운영체제가 제공하는 서비스 중 커널에 포함되지 않는 서비스도 있다. 
대표적인 것이 바로 **사용자 인터페이스(UI: User Interface)** 이다. 
UI는  윈도우의 바탕화면과 같이 사용자가 컴퓨터와 상호작용할 수 있는 창구 역할을 한다.

![[IMG-20250211165203803.png|500]]
운영체제가 제공하는 UI의 종류에는 그래픽 유저 인터페이스(GUI), 커맨드 라인 인터페이스(CLI)가 있다.
전자는 윈도우 바탕화면이나 스마트폰의 화면처럼 그래픽을 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스고, 후자는 명령어를 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스다.

#### 그래픽 유저 인터페이스(Graphic User Interface)
GUI는 마우스와 터치와 같은 **그래픽 요소를 사용하여 컴퓨터와 상호작용할 수 있는 인터페이스**다.

우리가 윈도우의 바탕화면이나 스마트폰 화면에서 아이콘을 클릭하거나 터치하여 프로그램을 실행할 수 있는 것은 윈도우의 운영체제와 스마트폰 속 운영체제가 그래픽 유저 인터페이스(GUI)를 지원하기 때문이다.

#### 커맨드 라인 인터페이스(Comaand Line Interface)
CLI는 **명령어를 기반으로 컴퓨터와 상호작용하는 방식**이다. 아이콘이나 그래픽 없이, 사용자가 직접 명령어를 입력하여 프로그램을 실행해야 한다. 리눅스 터미널이나 윈도우의 명령 프롬프트가 이에 해당한다.


## 이중모드(Dual Mode)
### 운영체제는 자원 접근의 문지기다.
![[IMG-20250211165203899.png|500]]
운영체제는 사용자가 실행하는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호한다.
만약 응용 프로그램이 CPU, 메모리, 하드 디스크 등에 마음대로 접근하고 조작한다면 자원이 무질서하게 관리될 것이고, 응용 프로그램이 조금만 실수해도 시스템 전체를 멈추게 할 수도 있다.

![[IMG-20250211165203937.png|400]]
운영 체제는 이러한 문제를 막기 위해 응**용 프로그램들이 자원에 접근할 때 오직 자신을 통해서만 접근하도록 하여 자원을 보호**한다.

운영체제가 **자원 접근의 문지기 역할**을 하는 것이다!

응용 프로그램이 자원에 접근하기 위해서 운영체제에 도움을 요청하는데, 이것은 운영체제 코드를 실행하려고 하는 것과 같다.
응용 프로그램의 요청을 받은 운영체제는 응용 프로그램 대신 자원에 접근하여 요청한 작업을 수행한다.

![[IMG-20250211165203998.png|400]]
예를 들어 응용 프로그램이 실행 과정에서 하드 디스크에 접근하여 데이터를 저장하려면 운영체제에 도움을 요청해야 하고, 운영체제는 커널 영역 내의 하드 디스크에 데이터를 저장하는 코드를 실행하여 응용 프로그램의 작업을 대신 수행해 준다.

### 이중 모드(dual mode)란?
이러한 운영체제의 문지기 역할은 **이중 모드(dual mode)** 라는 개념을 통해 구현된다.
이중 모드는 CPU가 명령어를 실행하는 방식을 `사용자 모드(user mode)`와 `커널 모드(kernel mode)` 두 가지로 나누는 개념이다.

즉, **CPU는 명령어를 사용자 모드, 커널 모드 2가지 모드로 실행할 수 있다.**

#### 사용자 모드(user mode)
![[IMG-20250211165204060.png]]
사용자 모드는 **운영체제 서비스를 제공받을 수 없는 실행 모드**다.
즉, **커널 영역의 코드를 실행할 수 없는 모드**다!
일반적인 응용 프로그램은 기본적으로 사용자 모드로 실행된다.

사용자 모드로 실행 중인 CPU는 입출력 명령어롸 같이 하드웨어 자원에 접근하는 명령어를 실행할 수 없다.
그래서 사용자 모드로 실행되는 일반적인 응용 프로그램은 자원에 접근할 수 없다!

#### 커널 모드(kernel mode)
![[IMG-20250211165204117.png]]
반면 **커널 모드는 운영체제 서비스를 제공받을 수 있는 실행 모드**다.
즉, 커널 영역의 코드를 실행할 수 있는 모드다. 
CPU가 커널 모드로 명령어를 실행하면 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있다.
운영체제는 커널 모드로 실행되기 때문에 자원에 접근할 수 있다.

> CPU가 사용자 모드로 실행 중인지, 커널 모드로 실행중인지는 플래그 레지스터 속 슈퍼바이저 플래그를 보면 알 수 있다.


## 시스템 호출(system call)
![[IMG-20250211165204181.png|400]]
사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제 서비스를 제공받으려면 운영체제에 요청을 보내 커널 모드로 전환되어야 한다.
이때 운영체제 서비스를 제공받기 위한 요청을 `시스템 호출(시스템 콜)`이라고 한다.

**사용자 모드로 실행되는 프로그램은 시스템 콜을 통해 커널 모드로 전환하여 운영체제 서비스를 제공받을 수 있다.**


### 시스템 호출은 일종의 인터럽트다.
시스템 호출은 **소프트웨어 인터럽트**의 한 종류다. 
일반적인 인터럽트는 하드웨어(키보드 입력, 네트워크 패킷 수신 등)에 의해 발생하지만, 시스템 호출은 **특정 명령어에 의해 발생하는 인터럽트**다.

시스템 호출을 발생시키는 명령어가 실행되면 CPU는 지금까지의 작업을 백업하고, 커널 영역 내의 시스템 호출을 수행하는 코드(인터럽트 서비스 루틴)을 실행한 뒤, 다시 기존에 실행하던 응용 프로그램으로 복귀하여 실행을 계속한다.


### 시스템 호출 실행 과정
응용 프로그램이 하드 디스크에 데이터를 저장하려는 경우를 예로 들어보자.

먼저 응용 프로그램은 하드 디스크에 접근 해야한다.
하지만 사용자 모드로 실행되는 동안에는 자원(하드 디스크)에 접근할 수 없기 때문에 커널 모드로 전환해야 한다.

#### 커널 모드로 전환하는 과정
![[IMG-20250211165204253.png|400]]
1. 응용 프로그램이 **하드 디스크에 데이터를 저장하는 시스템 호출을 요청**해 커널 모드로 전환한다.
2. 운영체제 내의 '**하드 디스크에 데이터를 저장하는 코드'를 실행함으로써 하드 디스크에 접근**한다.
3. 하드 디스크에 접근이 끝났다면 다시 **사용자 모드로 복귀**하여 실행을 계속한다.

![[IMG-20250211165204343.png|500]]
일반적으로 응용 프로그램은 실행 과정에서 운영체제 서비스들을 매우 빈번하게 이용한다.
그 과정에서 시스템 호출도 빈번하게 발생시키고, 사용자 모드와 커널모드를 오가며 실행된다.


## 가상 머신(vurtual machine)
이중 모드는 **커널 모드(Kernel Mode)와 사용자 모드(User Mode)** 두 가지 실행 모드를 지원하지만,  **가상화를 지원하는 현대 CPU는 두 가지 모드 이상을 지원한다.**

### 가상 머신이란?
가상 머신(Virtual Machine, VM)은 **소프트웨어적으로 만들어진 가상의 컴퓨터**이다.  
VM을 사용하면 실제 컴퓨터 위에서 새로운 운영체제를 설치하고, 그 위에서 응용 프로그램을 실행할 수 있다.
(나는 맥북을 사용하고 있는데 관공서 홈페이지를 이용할 때 제약이 있어 윈도우 운영체제의 가상컴퓨터를 만들어 사용하고 있다 ㅎㅎ)

### 가상 머신은 사용자 모드로 작동한다
가상 머신을 만들어 리눅스 운영체제를 사용한다고 가정해 보자.
![[Pasted image 20250211171418.png|400]]
VM은 실제 컴퓨터에서 실행되는 하나의 **응용 프로그램**이기 때문에, 기본적으로 **사용자 모드(User Mode)에서 실행된다**.
그러므로 가상 머신 내에 설치된 **운영체제 또한 사용자 모드에서 작동**한다.

### 하이퍼바이저 모드(Hypervisor Mode)
가상 머신에 설치된 응용 프로그램이 운영체제 서비스를 제공받기 위해서는 커널 모드로 전환되어야 할 것이다.  
근데 가상 머신에 설치된 운영체제도 사용자 모드로 작동하기 때문에 운영체제 서비스를 제공받기 어렵다.

이 문제를 해결하기 위해 **가상화를 지원하는 CPU는 '하이퍼바이저 모드(Hypervisor Mode)'를 추가적으로 제공**한다.
가상 머신에 설치된 운영체제는 하이퍼바이저 모드로써 작동되어 운영체제 기능을 수행할 수 있게 되고,
가상 머신 상에서 작동하는 응용 프로그램들이 운영체제 서비스를 받을 수 있도록 한다.


## 요약
운영체제에서 커널은 가장 핵심적인 역할을 하는 부분으로, 응용 프로그램이 안전하게 실행되도록 자원을 관리한다.
2. **커널(kernel)**: 운영체제의 핵심 부분으로, 자원 관리 및 보호 역할을 한다.
3. **이중 모드(dual mode)**: CPU가 사용자 모드와 커널 모드 두 가지로 동작하여 응용 프로그램이 직접 자원에 접근하지 못하도록 한다.
4. **시스템 호출(system call)**: 사용자 모드에서 실행되는 프로그램이 운영체제의 기능을 요청하는 방법이다. 이를 통해 프로그램이 자원을 사용할 수 있다.




참고
[혼자 공부하는 컴퓨터 구조+운영체제](https://m.yes24.com/Goods/Detail/111378840)